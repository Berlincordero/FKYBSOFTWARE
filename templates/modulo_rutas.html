{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo Rutas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="{% static 'css/bootstrap/bootstrap.min.css' %}" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .table thead th {
            background-color: #007bff;
            color: white;
        }
        .table tbody tr:hover {
            background-color: #e2e6ea;
        }
        .modal-header {
            background-color: #007bff;
            color: white;
        }
        .alert {
            display: none;
        }
    </style>
</head>

<div class="container mt-5">
    <h1 class="text-center">Rutas</h1>

    <div class="alert alert-success" id="successAlert" role="alert">
        {% if messages %}
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        {% endif %}
    </div>

    <div class="mb-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRouteModal">
            <i class="fa fa-plus"></i> Agregar Ruta
        </button>
    </div>

    <!-- Barra de búsqueda -->
    <div class="mb-3">
        <div class="input-group">
            <input type="text" id="searchDate" class="form-control" placeholder="Buscar por fecha (DD-MM-YYYY o DD/MM/YYYY)" onkeyup="filterRutas()">
            <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
        </div>
    </div>

    <!-- Filtro de estado -->
    <select id="filtroEstado" onchange="location = this.value;">
        <option value="?estado=todos" {% if request.GET.estado == 'todos' %}selected{% endif %}>Todos</option>
        <option value="?estado=activos" {% if request.GET.estado == 'activos' %}selected{% endif %}>Activos</option>
        <option value="?estado=inactivos" {% if request.GET.estado == 'inactivos' %}selected{% endif %}>Inactivos</option>
    </select>
    

    <!-- Tabla de Rutas -->
    <table class="table table-bordered" id="routesTable">
        <thead>
            <tr>
                <th>ID Ruta</th>
                <th>Fecha</th>
                <th>Provincia</th>
                <th>Cantón</th>
                <th>Distrito</th>
                <th>Dirección Exacta</th>
                <th>Conductor</th>
                <th>Vehículo</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% if rutas %}
                {% for ruta in rutas %}
                <tr data-estado="{{ ruta.activo|yesno:'true,false' }}">
                    <td>{{ ruta.id_ruta }}</td>
                    <td>{{ ruta.fecha_ruta }}</td>
                    <td>{{ ruta.provincia }}</td>
                    <td>{{ ruta.canton }}</td>
                    <td>{{ ruta.distrito }}</td>
                    <td>{{ ruta.direccion_exacta }}</td>
                    <td>{{ ruta.nombre_conductor }} {{ ruta.apellido_1 }}</td>
                    <td>{{ ruta.id_vehiculo }}</td>
                    <td>
                        {% if ruta.activo %}
                            <span class="badge bg-success">Activo</span>
                        {% else %}
                            <span class="badge bg-danger">Inactivo</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if ruta.activo %}
                            <button onclick="eliminarRuta('{{ ruta.id_ruta }}')" class="btn btn-danger">Desactivar</button>
                        {% else %}
                            <button onclick="activarRuta('{{ ruta.id_ruta }}')" class="btn btn-success">Activar</button>
                        {% endif %}

                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="9" class="text-center">No hay rutas del día en el sistema.</td>
                </tr>
            {% endif %}
        </tbody>

        <!-- Filtro de número de rutas -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <label for="filasTabla" class="form-label me-2">Mostrar:</label>
                <select id="filasTabla" class="form-select form-select-sm d-inline" style="width: auto;">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </div>
            <button class="btn" style="background-color: #00bcd4; color: white;" onclick="printRutas()">
                <i class="fa fa-print"></i> Imprimir Rutas
            </button>
        </div>
        
        
        
    </table>
    <a href="{% url 'modulo_transportes' %}" class="btn btn-secondary">Regresar</a>
</div>


<!-- Modal Agregar Ruta -->
<style>#addRouteModalLabel {
    color: white !important;
}
</style>
<div class="modal fade" id="addRouteModal" tabindex="-1" aria-labelledby="addRouteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="post" action="{% url 'transportes:agregar_ruta' %}">
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRouteModalLabel">Agregar Ruta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_ruta" class="form-label">ID Ruta (Factura)</label>
                        <input type="text" class="form-control" name="id_ruta" required>
                    </div>
                    <div class="mb-3">
                        <label for="fecha_ruta" class="form-label">Fecha Ruta</label>
                        <input type="date" class="form-control" name="fecha_ruta" required>
                    </div>

                    <div class="mb-3">
                        <label for="provincia" class="form-label">Provincia</label>
                        <select class="form-select" id="provincia" name="provincia" required>
                            <option value="">Seleccione una provincia</option>
                            <!-- Provincias se llenarán aquí con JS -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="canton" class="form-label">Cantón</label>
                        <select class="form-select" id="canton" name="canton" required>
                            <option value="">Seleccione un cantón</option>
                            <!-- Cantones se llenarán aquí con JS -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="distrito" class="form-label">Distrito</label>
                        <select class="form-select" id="distrito" name="distrito" required>
                            <option value="">Seleccione un distrito</option>
                            <!-- Distritos se llenarán aquí con JS -->
                        </select>
                    </div>
                    

                                        

                    
                    
                    <div class="mb-3">
                        <label for="direccion_exacta" class="form-label">Dirección Exacta</label>
                        <input type="text" class="form-control" name="direccion_exacta" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre_conductor" class="form-label">Conductor</label>
                        <select class="form-select" name="nombre_conductor" required>
                            {% for conductor in conductores %}
                            {% if conductor.activo %}
                            <option value="{{ conductor.id_conductor }}">{{ conductor.nombre_conductor }} {{ conductor.apellidos_1 }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_vehiculo" class="form-label">Vehículo</label>
                        <select class="form-select" name="id_vehiculo" required>
                            {% for vehiculo in vehiculos %}
                            {% if vehiculo.activo %}
                            <option value="{{ vehiculo.id_vehiculo }}">{{ vehiculo.marca }} {{ vehiculo.modelo }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Agregar Ruta</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Editar Ruta -->
<style>#editRouteModalLabel {
    color: white !important;
}
</style>
{% for ruta in rutas %}
<div class="modal fade" id="editRouteModal{{ ruta.id_ruta }}" tabindex="-1" aria-labelledby="editRouteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="post" action="{% url 'transportes:editar_ruta' ruta.id_ruta %}">
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRouteModalLabel">Editar Ruta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_ruta" class="form-label">ID Ruta (Factura)</label>
                        <input type="text" class="form-control" name="id_ruta" value="{{ ruta.id_ruta }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="fecha_ruta" class="form-label">Fecha Ruta</label>
                        <input type="date" class="form-control" name="fecha_ruta" value="{{ ruta.fecha_ruta }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" name="provincia" value="{{ ruta.provincia }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="canton" class="form-label">Cantón</label>
                        <input type="text" class="form-control" name="canton" value="{{ ruta.canton }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="distrito" class="form-label">Distrito</label>
                        <input type="text" class="form-control" name="distrito" value="{{ ruta.distrito }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="direccion_exacta" class="form-label">Dirección Exacta</label>
                        <input type="text" class="form-control" name="direccion_exacta" value="{{ ruta.direccion_exacta }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre_conductor" class="form-label">Conductor</label>
                        <select class="form-select" name="nombre_conductor" required>
                            {% for conductor in conductores %}
                            <option value="{{ conductor.id_conductor }}" {% if conductor.id_conductor == ruta.nombre_conductor %}selected{% endif %}>{{ conductor.nombre_conductor }} {{ conductor.apellidos_1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_vehiculo" class="form-label">Vehículo</label>
                        <select class="form-select" name="id_vehiculo" required>
                            {% for vehiculo in vehiculos %}
                            <option value="{{ vehiculo.id_vehiculo }}" {% if vehiculo.id_vehiculo == ruta.id_vehiculo %}selected{% endif %}>{{ vehiculo.marca }} {{ vehiculo.modelo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endfor %}

    <!-- Modal Confirmación de Eliminación -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas desactivar esta ruta?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Desactivar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirmación de Activación -->
    <div class="modal fade" id="confirmActivateModal" tabindex="-1" aria-labelledby="confirmActivateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="confirmActivateModalLabel">Confirmar Activación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas activar esta ruta?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="confirmActivateButton">Activar</button>
                </div>
            </div>
        </div>
    </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function convertDateFormat(dateStr) {
        const dateParts = dateStr.split(" ");
        const month = dateParts[0]; // Ejemplo: Nov.
        const day = parseInt(dateParts[1], 10); // Ejemplo: 2
        const year = parseInt(dateParts[2], 10); // Ejemplo: 2024

        const months = {
            "Jan.": "01", "Feb.": "02", "Mar.": "03", "Apr.": "04",
            "May": "05", "Jun.": "06", "Jul.": "07", "Aug.": "08",
            "Sep.": "09", "Oct.": "10", "Nov.": "11", "Dec.": "12"
        };

        return `${day < 10 ? '0' + day : day}/${months[month]}/${year}`;
    }

    function filterRutas() {
        const input = document.getElementById("searchDate").value;
        const table = document.getElementById("routesTable");
        const rows = table.getElementsByTagName("tr");
    
        for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName("td");
            const dateCell = cells[1] || {};
            const dateValue = dateCell.textContent || dateCell.innerText;
    
            // Asegúrate de que esta conversión sea correcta
            const formattedDate = convertDateFormat(dateValue);
    
            // Si el valor no se encuentra en la fecha, ocultamos la fila
            if (formattedDate.indexOf(input) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    }
    

    function setDeleteForm(routeId, actionUrl) {
        document.getElementById('routeId').textContent = routeId;
        document.getElementById('deleteForm').action = actionUrl;
    }

    // Mostrar la alerta de éxito
    function showSuccessAlert() {
        const successAlert = document.getElementById('successAlert');
        successAlert.style.display = 'block';
        setTimeout(() => {
            successAlert.style.display = 'none';
        }, 3000); // Ocultar después de 3 segundos
    }

    // Llama a la función si hay éxito
    window.onload = function() {
        {% if messages %}
            showSuccessAlert();
        {% endif %}
    };


    const costaRicaLocations = {
        "San José": {
            cantons: {
                "San José": [
                    "Carmen", "Merced", "Hospital", "Catedral", "Zapote",
                    "San Francisco de Dos Ríos", "Uruca", "Mata Redonda", 
                    "Pavas", "Hatillo", "San Sebastián"
                ],
                "Escazú": ["Escazú", "San Antonio", "San Rafael"],
                "Desamparados": [
                    "Desamparados", "San Miguel", "San Juan de Dios", 
                    "San Rafael Arriba", "San Antonio", "Frailes", 
                    "Patarra", "San Cristobal", "Rosario", "Damas", 
                    "San Rafael Abajo", "Gravilias", "Los Guido"
                ],
                "Puriscal": [
                    "Santiago", "Mercedes Sur", "Barbacoas", "Grifo Alto",
                    "San Rafael", "Candelarita", "Desamparaditos", 
                    "San Antonio", "Chires"
                ],
                "Tarrazú": ["San Marcos", "San Lorenzo", "San Carlos"],
                "Aserrí": ["Aserrí", "Tarbaca", "Vuelta de Jorco", "San Gabriel", "Legua", "Monterrey", "Salitrillos"],
                "Mora": ["Colón", "Guayabo", "Tabarcia", "Piedras Negras", "Picagres", "Jaris", "Quitirrisí"],
                "Goicoechea": ["Guadalupe", "San Francisco", "Calle Blancos", "Mata de Plátano", "Ipis", "Rancho Redondo", "Purral"],
                "Santa Ana": ["Santa Ana", "Salitral", "Pozos", "Uruca", "Piedades", "Brasil"],
                "Alajuelita": ["Alajuelita", "San Josecito", "San Antonio", "Concepción", "San Felipe"],
                "Vázquez de Coronado": ["San Isidro", "San Rafael", "Dulce Nombre de Jesús", "Patalillo", "Cascajal"],
                "Acosta": ["San Ignacio", "Guaitil", "Palmichal", "Cangrejal", "Sabanillas"],
                "Tibás": ["San Juan", "Cinco Esquinas", "Anselmo Llorente", "León XIII", "Colima"],
                "Moravia": ["San Vicente", "San Jerónimo", "La Trinidad"],
                "Montes de Oca": ["San Pedro", "Sabanilla", "Mercedes", "San Rafael"],
                "Turrubares": ["San Pablo", "San Pedro", "San Juan de Mata", "San Luis", "Carara"],
                "Dota": ["Santa María", "Jardín", "Copey"],
                "Curridabat": ["Curridabat", "Granadilla", "Sánchez", "Tirrases"],
                "Pérez Zeledón": ["San Isidro de El General", "El General", "Daniel Flores", "Rivas", "San Pedro", "Platanares", "Pejibaye", "Cajón", "Barú", "Río Nuevo", "Paramo", "La Amistad"],
                "León Cortés Castro": ["San Pablo", "San Andrés", "Llano Bonito", "San Isidro", "Santa Cruz", "San Antonio"]
            }
        },
        "Alajuela": {
            cantons: {
                "Alajuela": [
                    "Alajuela", "San José", "Carrizal", "San Antonio", 
                    "Guácima", "San Isidro", "Sabanilla", "San Rafael", 
                    "Río Segundo", "Desamparados", "Turrucares", 
                    "Tambor", "Garita", "Sarapiquí"
                ],
                "San Ramón": [
                    "San Ramón", "Santiago", "San Juan", "Piedades Norte", 
                    "Piedades Sur", "San Rafael", "San Isidro", 
                    "Ángeles", "Alfaro", "Volio", "Concepción", "Zapotal", 
                    "Peñas Blancas", "San Lorenzo"
                ],
                "Grecia": ["Grecia", "San Isidro", "San José", "San Roque", "Tacares", "Puente de Piedra", "Bolivar"],
                "San Mateo": ["San Mateo", "Desmonte", "Jesús María", "Labrador"],
                "Atenas": ["Atenas", "Jesús", "Mercedes", "San Isidro", "Concepción", "San José", "Santa Eulalia", "Escobal"],
                "Naranjo": ["Naranjo", "San Miguel", "San José", "Cirrí Sur", "San Jerónimo", "San Juan", "El Rosario", "Palmitos"],
                "Palmares": ["Palmares", "Zaragoza", "Buenos Aires", "Santiago", "Candelaria", "Esquipulas", "La Granja"],
                "Poás": ["San Pedro", "San Juan", "San Rafael", "Carrillos", "Sabana Redonda"],
                "Orotina": ["Orotina", "El Mastate", "Hacienda Vieja", "Coyolar", "La Ceiba"],
                "San Carlos": ["Quesada", "Florencia", "Buenavista", "Aguas Zarcas", "Venecia", "Pital", "La Fortuna", "La Tigra", "La Palmera", "Venado", "Cutris", "Monterrey", "Pocosol"],
                "Zarcero": ["Zarcero", "Laguna", "Tapesco", "Guadalupe", "Palmira", "Zapote", "Brisas"],
                "Sarchí": ["Sarchí Norte", "Sarchí Sur", "Toro Amarillo", "San Pedro", "Rodríguez"],
                "Upala": ["Upala", "Aguas Claras", "San José O Pizote", "Bijagua", "Delicias", "Dos Ríos", "Yolillal", "Canalete"],
                "Los Chiles": ["Los Chiles", "Caño Negro", "El Amparo", "San Jorge"],
                "Guatuso": ["San Rafael", "Buenavista", "Cote", "Katira"],
                "Río Cuarto": ["Río Cuarto", "Santa Rita", "Santa Isabel"]
            }
        },
        "Cartago": {
            cantons: {
                "Cartago": [
                    "Oriental", "Occidental", "Carmen", "San Nicolás", 
                    "Aguacaliente o San Francisco", "Guadalupe o Arenilla", 
                    "Corralillo", "Tierra Blanca", "Dulce Nombre", 
                    "Llano Grande", "Quebradilla"
                ],
                "Paraíso": ["Paraíso", "Santiago", "Orosi", "Cachí", "Llanos de Santa Lucía"],
                "La Unión": ["Tres Ríos", "San Diego", "San Juan", "San Rafael", "Concepción", "Dulce Nombre", "San Ramón", "Río Azul"],
                "Jiménez": ["Juan Viñas", "Tucurrique", "Pejibaye"],
                "Turrialba": ["Turrialba", "La Suiza", "Peralta", "Santa Cruz", "Santa Teresita", "Pavones", "Tuis", "Tayutic", "Santa Rosa", "Tres Equis", "La Isabel", "Chirripó"],
                "Alvarado": ["Pacayas", "Cervantes", "Capellades"],
                "Oreamuno": ["San Rafael", "Cot", "Potrero Cerrado", "Cipreses", "Santa Rosa"],
                "El Guarco": ["El Tejar", "San Isidro", "Tobosi", "Patio de Agua"]
            }
        },
        "Heredia": {
            cantons: {
                "Heredia": [
                    "Heredia", "Mercedes", "San Francisco", "Ulloa", 
                    "Varablanca"
                ],
                "Barva": ["Barva", "San Pedro", "San Pablo", "San Roque", "Santa Lucía", "San José de la Montaña"],
                "Santo Domingo": ["Santo Domingo", "San Vicente", "San Miguel", "Paracito", "Santo Tomás", "Santa Rosa", "Tures", "Pará"],
                "Santa Bárbara": ["Santa Bárbara", "San Pedro", "San Juan", "Jesús", "Santo Domingo", "Purabá"],
                "San Rafael": ["San Rafael", "San Josecito", "Santiago", "Ángeles", "Concepción"],
                "San Isidro": ["San Isidro", "San José", "Concepción", "San Francisco"],
                "Belén": ["San Antonio", "La Ribera", "La Asunción"],
                "Flores": ["San Joaquín", "Barrantes", "Llorente"],
                "San Pablo": ["San Pablo", "Rincón de Sabanilla"],
                "Sarapiquí": ["Puerto Viejo", "La Virgen", "Las Horquetas", "Llanuras del Gaspar", "Cureña"]
            }
        },
            "Guanacaste": {
            cantons: {
                "Liberia": ["Liberia", "Cañas Dulces", "Mayorga", "Nacascolo", "Curubandé"],
                "Nicoya": ["Nicoya", "Mansión", "San Antonio", "Quebrada Honda", "Sámara", "Nosara", "Belén de Nosarita"],
                "Santa Cruz": ["Santa Cruz", "Bolsón", "Veintisiete de Abril", "Tempate", "Cartagena", "Cuajiniquil", "Diriá", "Cabo Velas", "Tamarindo"],
                "Bagaces": ["Bagaces", "La Fortuna", "Mogote", "Río Naranjo"],
                "Carrillo": ["Filadelfia", "Palmira", "Sardinal", "Belén"],
                "Cañas": ["Cañas", "Palmira", "San Miguel", "Bebedero", "Porozal"],
                "Abangares": ["Las Juntas", "Sierra", "San Juan", "Colorado"],
                "Tilarán": ["Tilarán", "Quebrada Grande", "Tronadora", "Santa Rosa", "Líbano", "Tierras Morenas", "Arenal"],
                "Nandayure": ["Carmona", "Santa Rita", "Zapotal", "San Pablo", "Porvenir", "Bejuco"],
                "La Cruz": ["La Cruz", "Santa Cecilia", "La Garita", "Santa Elena"],
                "Hojancha": ["Hojancha", "Monte Romo", "Puerto Carrillo", "Huacas", "Matambú"]
            }
        },
        "Puntarenas": {
            cantons: {
                "Puntarenas": [
                    "Puntarenas", "Pitahaya", "Chomes", "Lepanto", "Paquera", 
                    "Manzanillo", "Guacimal", "Barranca", "Isla del Coco", 
                    "Cóbano", "Chacarita", "Chira", "Acapulco", 
                    "El Roble", "Arancibia"
                ],
                "Esparza": ["Espíritu Santo", "San Juan Grande", "Macacona", "San Rafael", "San Jerónimo", "Caldera"],
                "Buenos Aires": ["Buenos Aires", "Volcán", "Potrero Grande", "Boruca", "Pilas", "Colinas", "Chánguena", "Biolley", "Brunka"],
                "Montes de Oro": ["Miramar", "La Unión", "San Isidro"],
                "Osa": ["Puerto Cortés", "Palmar", "Sierpe", "Bahía Ballena", "Piedras Blancas", "Bahía Drake"],
                "Quepos": ["Quepos", "Savegre", "Naranjito"],
                "Golfito": ["Golfito", "Puerto Jiménez", "Guaycará", "Pavón"],
                "Coto Brus": ["San Vito", "Sabalito", "Aguabuena", "Limoncito", "Pittier", "Gutiérrez Braun"],
                "Parrita": ["Parrita"],
                "Corredores": ["Corredor", "La Cuesta", "Canoas", "Laurel"],
                "Garabito": ["Jacó", "Tárcoles"],
                "Monteverde": ["Monteverde"]
            }
        },
        "Limón": {
            cantons: {
                "Limón": ["Limón", "Valle La Estrella", "Río Blanco", "Matama"],
                "Pococí": ["Guápiles", "Jiménez", "Rita", "Roxana", "Cariari", "Colorado", "La Colonia"],
                "Siquirres": ["Siquirres", "Pacuarito", "Florida", "Germania", "El Cairo", "Alegría", "Reventazón"],
                "Talamanca": ["Bratsi", "Sixaola", "Cahuita", "Telire"],
                "Matina": ["Matina", "Batán", "Carrandí"],
                "Guácimo": ["Guácimo", "Mercedes", "Pocora", "Río Jiménez", "Duacarí"]
            }
        }
    };
    
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Objeto de ubicaciones
        const costaRicaLocations = {
            "San José": {
                cantons: {
                    "San José": [
                        "Carmen", "Merced", "Hospital", "Catedral", "Zapote",
                        "San Francisco de Dos Ríos", "Uruca", "Mata Redonda", 
                        "Pavas", "Hatillo", "San Sebastián"
                    ],
                    "Escazú": ["Escazú", "San Antonio", "San Rafael"],
                    "Desamparados": [
                        "Desamparados", "San Miguel", "San Juan de Dios", 
                        "San Rafael Arriba", "San Antonio", "Frailes", 
                        "Patarra", "San Cristobal", "Rosario", "Damas", 
                        "San Rafael Abajo", "Gravilias", "Los Guido"
                    ],
                    "Puriscal": [
                        "Santiago", "Mercedes Sur", "Barbacoas", "Grifo Alto",
                        "San Rafael", "Candelarita", "Desamparaditos", 
                        "San Antonio", "Chires"
                    ],
                    "Tarrazú": ["San Marcos", "San Lorenzo", "San Carlos"],
                    "Aserrí": ["Aserrí", "Tarbaca", "Vuelta de Jorco", "San Gabriel", "Legua", "Monterrey", "Salitrillos"],
                    "Mora": ["Colón", "Guayabo", "Tabarcia", "Piedras Negras", "Picagres", "Jaris", "Quitirrisí"],
                    "Goicoechea": ["Guadalupe", "San Francisco", "Calle Blancos", "Mata de Plátano", "Ipis", "Rancho Redondo", "Purral"],
                    "Santa Ana": ["Santa Ana", "Salitral", "Pozos", "Uruca", "Piedades", "Brasil"],
                    "Alajuelita": ["Alajuelita", "San Josecito", "San Antonio", "Concepción", "San Felipe"],
                    "Vázquez de Coronado": ["San Isidro", "San Rafael", "Dulce Nombre de Jesús", "Patalillo", "Cascajal"],
                    "Acosta": ["San Ignacio", "Guaitil", "Palmichal", "Cangrejal", "Sabanillas"],
                    "Tibás": ["San Juan", "Cinco Esquinas", "Anselmo Llorente", "León XIII", "Colima"],
                    "Moravia": ["San Vicente", "San Jerónimo", "La Trinidad"],
                    "Montes de Oca": ["San Pedro", "Sabanilla", "Mercedes", "San Rafael"],
                    "Turrubares": ["San Pablo", "San Pedro", "San Juan de Mata", "San Luis", "Carara"],
                    "Dota": ["Santa María", "Jardín", "Copey"],
                    "Curridabat": ["Curridabat", "Granadilla", "Sánchez", "Tirrases"],
                    "Pérez Zeledón": ["San Isidro de El General", "El General", "Daniel Flores", "Rivas", "San Pedro", "Platanares", "Pejibaye", "Cajón", "Barú", "Río Nuevo", "Paramo", "La Amistad"],
                    "León Cortés Castro": ["San Pablo", "San Andrés", "Llano Bonito", "San Isidro", "Santa Cruz", "San Antonio"]
                }
            },
            "Alajuela": {
                cantons: {
                    "Alajuela": [
                        "Alajuela", "San José", "Carrizal", "San Antonio", 
                        "Guácima", "San Isidro", "Sabanilla", "San Rafael", 
                        "Río Segundo", "Desamparados", "Turrucares", 
                        "Tambor", "Garita", "Sarapiquí"
                    ],
                    "San Ramón": [
                        "San Ramón", "Santiago", "San Juan", "Piedades Norte", 
                        "Piedades Sur", "San Rafael", "San Isidro", 
                        "Ángeles", "Alfaro", "Volio", "Concepción", "Zapotal", 
                        "Peñas Blancas", "San Lorenzo"
                    ],
                    "Grecia": ["Grecia", "San Isidro", "San José", "San Roque", "Tacares", "Puente de Piedra", "Bolivar"],
                    "San Mateo": ["San Mateo", "Desmonte", "Jesús María", "Labrador"],
                    "Atenas": ["Atenas", "Jesús", "Mercedes", "San Isidro", "Concepción", "San José", "Santa Eulalia", "Escobal"],
                    "Naranjo": ["Naranjo", "San Miguel", "San José", "Cirrí Sur", "San Jerónimo", "San Juan", "El Rosario", "Palmitos"],
                    "Palmares": ["Palmares", "Zaragoza", "Buenos Aires", "Santiago", "Candelaria", "Esquipulas", "La Granja"],
                    "Poás": ["San Pedro", "San Juan", "San Rafael", "Carrillos", "Sabana Redonda"],
                    "Orotina": ["Orotina", "El Mastate", "Hacienda Vieja", "Coyolar", "La Ceiba"],
                    "San Carlos": ["Quesada", "Florencia", "Buenavista", "Aguas Zarcas", "Venecia", "Pital", "La Fortuna", "La Tigra", "La Palmera", "Venado", "Cutris", "Monterrey", "Pocosol"],
                    "Zarcero": ["Zarcero", "Laguna", "Tapesco", "Guadalupe", "Palmira", "Zapote", "Brisas"],
                    "Sarchí": ["Sarchí Norte", "Sarchí Sur", "Toro Amarillo", "San Pedro", "Rodríguez"],
                    "Upala": ["Upala", "Aguas Claras", "San José O Pizote", "Bijagua", "Delicias", "Dos Ríos", "Yolillal", "Canalete"],
                    "Los Chiles": ["Los Chiles", "Caño Negro", "El Amparo", "San Jorge"],
                    "Guatuso": ["San Rafael", "Buenavista", "Cote", "Katira"],
                    "Río Cuarto": ["Río Cuarto", "Santa Rita", "Santa Isabel"]
                }
            },
            "Cartago": {
                cantons: {
                    "Cartago": [
                        "Oriental", "Occidental", "Carmen", "San Nicolás", 
                        "Aguacaliente o San Francisco", "Guadalupe o Arenilla", 
                        "Corralillo", "Tierra Blanca", "Dulce Nombre", 
                        "Llano Grande", "Quebradilla"
                    ],
                    "Paraíso": ["Paraíso", "Santiago", "Orosi", "Cachí", "Llanos de Santa Lucía"],
                    "La Unión": ["Tres Ríos", "San Diego", "San Juan", "San Rafael", "Concepción", "Dulce Nombre", "San Ramón", "Río Azul"],
                    "Jiménez": ["Juan Viñas", "Tucurrique", "Pejibaye"],
                    "Turrialba": ["Turrialba", "La Suiza", "Peralta", "Santa Cruz", "Santa Teresita", "Pavones", "Tuis", "Tayutic", "Santa Rosa", "Tres Equis", "La Isabel", "Chirripó"],
                    "Alvarado": ["Pacayas", "Cervantes", "Capellades"],
                    "Oreamuno": ["San Rafael", "Cot", "Potrero Cerrado", "Cipreses", "Santa Rosa"],
                    "El Guarco": ["El Tejar", "San Isidro", "Tobosi", "Patio de Agua"]
                }
            },
            "Heredia": {
                cantons: {
                    "Heredia": [
                        "Heredia", "Mercedes", "San Francisco", "Ulloa", 
                        "Varablanca"
                    ],
                    "Barva": ["Barva", "San Pedro", "San Pablo", "San Roque", "Santa Lucía", "San José de la Montaña"],
                    "Santo Domingo": ["Santo Domingo", "San Vicente", "San Miguel", "Paracito", "Santo Tomás", "Santa Rosa", "Tures", "Pará"],
                    "Santa Bárbara": ["Santa Bárbara", "San Pedro", "San Juan", "Jesús", "Santo Domingo", "Purabá"],
                    "San Rafael": ["San Rafael", "San Josecito", "Santiago", "Ángeles", "Concepción"],
                    "San Isidro": ["San Isidro", "San José", "Concepción", "San Francisco"],
                    "Belén": ["San Antonio", "La Ribera", "La Asunción"],
                    "Flores": ["San Joaquín", "Barrantes", "Llorente"],
                    "San Pablo": ["San Pablo", "Rincón de Sabanilla"],
                    "Sarapiquí": ["Puerto Viejo", "La Virgen", "Las Horquetas", "Llanuras del Gaspar", "Cureña"]
                }
            },
                "Guanacaste": {
                cantons: {
                    "Liberia": ["Liberia", "Cañas Dulces", "Mayorga", "Nacascolo", "Curubandé"],
                    "Nicoya": ["Nicoya", "Mansión", "San Antonio", "Quebrada Honda", "Sámara", "Nosara", "Belén de Nosarita"],
                    "Santa Cruz": ["Santa Cruz", "Bolsón", "Veintisiete de Abril", "Tempate", "Cartagena", "Cuajiniquil", "Diriá", "Cabo Velas", "Tamarindo"],
                    "Bagaces": ["Bagaces", "La Fortuna", "Mogote", "Río Naranjo"],
                    "Carrillo": ["Filadelfia", "Palmira", "Sardinal", "Belén"],
                    "Cañas": ["Cañas", "Palmira", "San Miguel", "Bebedero", "Porozal"],
                    "Abangares": ["Las Juntas", "Sierra", "San Juan", "Colorado"],
                    "Tilarán": ["Tilarán", "Quebrada Grande", "Tronadora", "Santa Rosa", "Líbano", "Tierras Morenas", "Arenal"],
                    "Nandayure": ["Carmona", "Santa Rita", "Zapotal", "San Pablo", "Porvenir", "Bejuco"],
                    "La Cruz": ["La Cruz", "Santa Cecilia", "La Garita", "Santa Elena"],
                    "Hojancha": ["Hojancha", "Monte Romo", "Puerto Carrillo", "Huacas", "Matambú"]
                }
            },
            "Puntarenas": {
                cantons: {
                    "Puntarenas": [
                        "Puntarenas", "Pitahaya", "Chomes", "Lepanto", "Paquera", 
                        "Manzanillo", "Guacimal", "Barranca", "Isla del Coco", 
                        "Cóbano", "Chacarita", "Chira", "Acapulco", 
                        "El Roble", "Arancibia"
                    ],
                    "Esparza": ["Espíritu Santo", "San Juan Grande", "Macacona", "San Rafael", "San Jerónimo", "Caldera"],
                    "Buenos Aires": ["Buenos Aires", "Volcán", "Potrero Grande", "Boruca", "Pilas", "Colinas", "Chánguena", "Biolley", "Brunka"],
                    "Montes de Oro": ["Miramar", "La Unión", "San Isidro"],
                    "Osa": ["Puerto Cortés", "Palmar", "Sierpe", "Bahía Ballena", "Piedras Blancas", "Bahía Drake"],
                    "Quepos": ["Quepos", "Savegre", "Naranjito"],
                    "Golfito": ["Golfito", "Puerto Jiménez", "Guaycará", "Pavón"],
                    "Coto Brus": ["San Vito", "Sabalito", "Aguabuena", "Limoncito", "Pittier", "Gutiérrez Braun"],
                    "Parrita": ["Parrita"],
                    "Corredores": ["Corredor", "La Cuesta", "Canoas", "Laurel"],
                    "Garabito": ["Jacó", "Tárcoles"],
                    "Monteverde": ["Monteverde"]
                }
            },
            "Limón": {
                cantons: {
                    "Limón": ["Limón", "Valle La Estrella", "Río Blanco", "Matama"],
                    "Pococí": ["Guápiles", "Jiménez", "Rita", "Roxana", "Cariari", "Colorado", "La Colonia"],
                    "Siquirres": ["Siquirres", "Pacuarito", "Florida", "Germania", "El Cairo", "Alegría", "Reventazón"],
                    "Talamanca": ["Bratsi", "Sixaola", "Cahuita", "Telire"],
                    "Matina": ["Matina", "Batán", "Carrandí"],
                    "Guácimo": ["Guácimo", "Mercedes", "Pocora", "Río Jiménez", "Duacarí"]
                }
            }
        };

        // Inicializar las provincias en el dropdown
        const provincias = Object.keys(costaRicaLocations);
        provincias.forEach(function(provincia) {
            document.getElementById("provincia").innerHTML += `<option value="${provincia}">${provincia}</option>`;
        });

        // Manejar el cambio en la provincia
        document.getElementById("provincia").addEventListener("change", function() {
            const provincia = this.value;
            const cantones = provincia in costaRicaLocations ? Object.keys(costaRicaLocations[provincia].cantons) : [];
            
            // Limpiar y actualizar el dropdown de cantones
            const cantonSelect = document.getElementById("canton");
            cantonSelect.innerHTML = "<option value=''>Seleccione un cantón</option>";
            cantones.forEach(function(canton) {
                cantonSelect.innerHTML += `<option value="${canton}">${canton}</option>`;
            });
            
            // Limpiar el dropdown de distritos
            document.getElementById("distrito").innerHTML = "<option value=''>Seleccione un distrito</option>";
        });

        // Manejar el cambio en el cantón
        document.getElementById("canton").addEventListener("change", function() {
            const provincia = document.getElementById("provincia").value;
            const canton = this.value;
            const distritos = provincia && canton && costaRicaLocations[provincia].cantons[canton] ? costaRicaLocations[provincia].cantons[canton] : [];

            // Limpiar y actualizar el dropdown de distritos
            const distritoSelect = document.getElementById("distrito");
            distritoSelect.innerHTML = "<option value=''>Seleccione un distrito</option>";
            distritos.forEach(function(distrito) {
                distritoSelect.innerHTML += `<option value="${distrito}">${distrito}</option>`;
            });
        });
    });


    function printRutas() {
        // Obtener la tabla de rutas
        const table = document.getElementById("routesTable").outerHTML;
    
        // Crear una nueva ventana para imprimir
        const printWindow = window.open("", "_blank");
    
        // Formato de la página de impresión
        printWindow.document.write(`
            <html>
            <head>
                <title></title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
                <style>
                    h1 { text-align: center; margin-top: 20px; }
                    .table th, .table td { border: 1px solid #dee2e6; padding: 8px; }
                    .table th { background-color: #007bff; color: white; }
                </style>
            </head>
            <body>
                <h1>Listado de Rutas</h1>
                <p>Fecha de impresión: ${new Date().toLocaleDateString("es-ES")}</p>
                ${table}
            </body>
            </html>
        `);
    
        // Cerrar el documento de la ventana y activar la impresión
        printWindow.document.close();
        printWindow.print();
    }
    
</script>

<script>
    //Gestionar el filtro de cantidad de conductores mostrados
    document.addEventListener('DOMContentLoaded', function () {
        const filasTabla = document.getElementById('filasTabla');
        const tablaCuerpo = document.querySelector('#routesTable tbody');
        const filas = Array.from(tablaCuerpo.querySelectorAll('tr'));

        // Función para actualizar la cantidad de filas visibles
        function actualizarFilas() {
            const cantidad = parseInt(filasTabla.value, 10);

            // Mostrar solo las filas seleccionadas
            filas.forEach((fila, index) => {
                if (index < cantidad) {
                    fila.style.display = ''; // Mostrar
                } else {
                    fila.style.display = 'none'; // Ocultar
                }
            });
        }

        // Actualizar filas cuando cambie el valor del desplegable
        filasTabla.addEventListener('change', actualizarFilas);

        // Mostrar solo las filas seleccionadas al cargar la página
        actualizarFilas();
    });
</script>

<script>
    let rutaIdToDelete = null;

    function eliminarRuta(idRuta) {
        if (confirm('¿Estás seguro de que deseas desactivar esta ruta?')) {
            fetch(`/transportes/eliminar_ruta/${idRuta}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // Recarga la página para reflejar los cambios
                } else {
                    alert('Error al desactivar la ruta');
                }
            })
            .catch(error => alert('Error de conexión'));
        }
    }
    

</script>



<script>
let rutaIdToActivate = null;

function activarRuta(idRuta) {
    if (confirm('¿Estás seguro de que deseas activar esta ruta?')) {
        fetch(`/transportes/activar_ruta/${idRuta}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload(); // Recarga la página para reflejar los cambios
            } else {
                alert('Error al activar la ruta');
            }
        })
        .catch(error => alert('Error de conexión'));
    }
}


</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("filtroEstado").addEventListener("change", function () {
            var estadoSeleccionado = this.value;
            var filas = document.querySelectorAll("#routesTable tbody tr");
    
            filas.forEach(function (fila) {
                var estado = fila.getAttribute("data-estado");
    
                // Normaliza los valores
                if (estado === "true") estado = "activo";
                if (estado === "false") estado = "inactivo";
    
                // Filtra según el estado seleccionado
                if (estadoSeleccionado === "todos") {
                    fila.style.display = "";  // Mostrar todas
                } else if (estadoSeleccionado === "activos" && estado === "activo") {
                    fila.style.display = "";  // Mostrar solo activas
                } else if (estadoSeleccionado === "inactivos" && estado === "inactivo") {
                    fila.style.display = "";  // Mostrar solo inactivas
                } else {
                    fila.style.display = "none";  // Ocultar las que no coinciden
                }
            });
        });
    });
    
    <script>
        function eliminarRuta(id) {
            document.getElementById('confirmDeleteBtn').setAttribute('onclick', `confirmarEliminacion(${id})`);
            var myModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            myModal.show();
        }
        
        function activarRuta(id) {
            document.getElementById('confirmActivateBtn').setAttribute('onclick', `confirmarActivacion(${id})`);
            var myModal = new bootstrap.Modal(document.getElementById('confirmActivateModal'));
            myModal.show();
        }
        
        function confirmarEliminacion(id) {
            // Aquí debes hacer la petición para eliminar la ruta
            console.log('Eliminando ruta con ID:', id);
        }
        
        function confirmarActivacion(id) {
            // Aquí debes hacer la petición para activar la ruta
            console.log('Activando ruta con ID:', id);
        }
        
    </script>




{% endblock %}
