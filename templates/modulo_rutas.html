{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mﾃｳdulo Rutas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .table thead th {
            background-color: #007bff;
            color: white;
        }
        .table tbody tr:hover {
            background-color: #e2e6ea;
        }
        .modal-header {
            background-color: #007bff;
            color: white;
        }
        .alert {
            display: none;
        }
    </style>
</head>

<div class="container mt-5">
    <h1 class="text-center">Rutas</h1>

    <div class="alert alert-success" id="successAlert" role="alert">
        {% if messages %}
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        {% endif %}
    </div>

    <div class="mb-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRouteModal">
            <i class="fa fa-plus"></i> Agregar Ruta
        </button>
    </div>

    <!-- Barra de bﾃｺsqueda -->
    <div class="mb-3">
        <div class="input-group">
            <input type="text" id="searchDate" class="form-control" placeholder="Buscar por fecha (DD-MM-YYYY o DD/MM/YYYY)" onkeyup="filterRutas()">
            <span class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></span>
        </div>
    </div>

    <!-- Filtro de estado -->
    <select id="filtroEstado" onchange="location = this.value;">
        <option value="?estado=todos" {% if request.GET.estado == 'todos' %}selected{% endif %}>Todos</option>
        <option value="?estado=activos" {% if request.GET.estado == 'activos' %}selected{% endif %}>Activos</option>
        <option value="?estado=inactivos" {% if request.GET.estado == 'inactivos' %}selected{% endif %}>Inactivos</option>
    </select>
    

    <!-- Tabla de Rutas -->
    <table class="table table-bordered" id="routesTable">
        <thead>
            <tr>
                <th>ID Ruta</th>
                <th>Fecha</th>
                <th>Provincia</th>
                <th>Cantﾃｳn</th>
                <th>Distrito</th>
                <th>Direcciﾃｳn Exacta</th>
                <th>Conductor</th>
                <th>Vehﾃｭculo</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% if rutas %}
                {% for ruta in rutas %}
                <tr data-estado="{{ ruta.activo|yesno:'true,false' }}">
                    <td>{{ ruta.id_ruta }}</td>
                    <td>{{ ruta.fecha_ruta }}</td>
                    <td>{{ ruta.provincia }}</td>
                    <td>{{ ruta.canton }}</td>
                    <td>{{ ruta.distrito }}</td>
                    <td>{{ ruta.direccion_exacta }}</td>
                    <td>{{ ruta.nombre_conductor }} {{ ruta.apellido_1 }}</td>
                    <td>{{ ruta.id_vehiculo }}</td>
                    <td>
                        {% if ruta.activo %}
                            <span class="badge bg-success">Activo</span>
                        {% else %}
                            <span class="badge bg-danger">Inactivo</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if ruta.activo %}
                            <button onclick="eliminarRuta('{{ ruta.id_ruta }}')" class="btn btn-danger">Desactivar</button>
                        {% else %}
                            <button onclick="activarRuta('{{ ruta.id_ruta }}')" class="btn btn-success">Activar</button>
                        {% endif %}

                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="9" class="text-center">No hay rutas del dﾃｭa en el sistema.</td>
                </tr>
            {% endif %}
        </tbody>

        <!-- Filtro de nﾃｺmero de rutas -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <label for="filasTabla" class="form-label me-2">Mostrar:</label>
                <select id="filasTabla" class="form-select form-select-sm d-inline" style="width: auto;">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </div>
            <button onclick="generatePDF()" class="btn btn-primary">Imprimir rutas</button>
        </div>
        
        
        
    </table>
    <a href="{% url 'modulo_transportes' %}" class="btn btn-secondary">Regresar</a>
</div>


<!-- Modal Agregar Ruta -->
<style>#addRouteModalLabel {
    color: white !important;
}
</style>
<div class="modal fade" id="addRouteModal" tabindex="-1" aria-labelledby="addRouteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="post" action="{% url 'transportes:agregar_ruta' %}">
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addRouteModalLabel">Agregar Ruta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_ruta" class="form-label">ID Ruta (Factura)</label>
                        <input type="text" class="form-control" name="id_ruta" required>
                    </div>
                    <div class="mb-3">
                        <label for="fecha_ruta" class="form-label">Fecha Ruta</label>
                        <input type="date" class="form-control" name="fecha_ruta" required>
                    </div>

                    <div class="mb-3">
                        <label for="provincia" class="form-label">Provincia</label>
                        <select class="form-select" id="provincia" name="provincia" required>
                            <option value="">Seleccione una provincia</option>
                            <!-- Provincias se llenarﾃ｡n aquﾃｭ con JS -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="canton" class="form-label">Cantﾃｳn</label>
                        <select class="form-select" id="canton" name="canton" required>
                            <option value="">Seleccione un cantﾃｳn</option>
                            <!-- Cantones se llenarﾃ｡n aquﾃｭ con JS -->
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="distrito" class="form-label">Distrito</label>
                        <select class="form-select" id="distrito" name="distrito" required>
                            <option value="">Seleccione un distrito</option>
                            <!-- Distritos se llenarﾃ｡n aquﾃｭ con JS -->
                        </select>
                    </div>
                    

                                        

                    
                    
                    <div class="mb-3">
                        <label for="direccion_exacta" class="form-label">Direcciﾃｳn Exacta</label>
                        <input type="text" class="form-control" name="direccion_exacta" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre_conductor" class="form-label">Conductor</label>
                        <select class="form-select" name="nombre_conductor" required>
                            {% for conductor in conductores %}
                            {% if conductor.activo %}
                            <option value="{{ conductor.id_conductor }}">{{ conductor.nombre_conductor }} {{ conductor.apellidos_1 }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_vehiculo" class="form-label">Vehﾃｭculo</label>
                        <select class="form-select" name="id_vehiculo" required>
                            {% for vehiculo in vehiculos %}
                            {% if vehiculo.activo %}
                            <option value="{{ vehiculo.id_vehiculo }}">{{ vehiculo.marca }} {{ vehiculo.modelo }}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Agregar Ruta</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Editar Ruta -->
<style>#editRouteModalLabel {
    color: white !important;
}
</style>
{% for ruta in rutas %}
<div class="modal fade" id="editRouteModal{{ ruta.id_ruta }}" tabindex="-1" aria-labelledby="editRouteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form method="post" action="{% url 'transportes:editar_ruta' ruta.id_ruta %}">
            {% csrf_token %}
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editRouteModalLabel">Editar Ruta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="id_ruta" class="form-label">ID Ruta (Factura)</label>
                        <input type="text" class="form-control" name="id_ruta" value="{{ ruta.id_ruta }}" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="fecha_ruta" class="form-label">Fecha Ruta</label>
                        <input type="date" class="form-control" name="fecha_ruta" value="{{ ruta.fecha_ruta }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="provincia" class="form-label">Provincia</label>
                        <input type="text" class="form-control" name="provincia" value="{{ ruta.provincia }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="canton" class="form-label">Cantﾃｳn</label>
                        <input type="text" class="form-control" name="canton" value="{{ ruta.canton }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="distrito" class="form-label">Distrito</label>
                        <input type="text" class="form-control" name="distrito" value="{{ ruta.distrito }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="direccion_exacta" class="form-label">Direcciﾃｳn Exacta</label>
                        <input type="text" class="form-control" name="direccion_exacta" value="{{ ruta.direccion_exacta }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre_conductor" class="form-label">Conductor</label>
                        <select class="form-select" name="nombre_conductor" required>
                            {% for conductor in conductores %}
                            <option value="{{ conductor.id_conductor }}" {% if conductor.id_conductor == ruta.nombre_conductor %}selected{% endif %}>{{ conductor.nombre_conductor }} {{ conductor.apellidos_1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_vehiculo" class="form-label">Vehﾃｭculo</label>
                        <select class="form-select" name="id_vehiculo" required>
                            {% for vehiculo in vehiculos %}
                            <option value="{{ vehiculo.id_vehiculo }}" {% if vehiculo.id_vehiculo == ruta.id_vehiculo %}selected{% endif %}>{{ vehiculo.marca }} {{ vehiculo.modelo }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endfor %}

    <!-- Modal Confirmaciﾃｳn de Eliminaciﾃｳn -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Eliminaciﾃｳn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ﾂｿEstﾃ｡s seguro de que deseas desactivar esta ruta?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Desactivar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Confirmaciﾃｳn de Activaciﾃｳn -->
    <div class="modal fade" id="confirmActivateModal" tabindex="-1" aria-labelledby="confirmActivateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="confirmActivateModalLabel">Confirmar Activaciﾃｳn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ﾂｿEstﾃ｡s seguro de que deseas activar esta ruta?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="confirmActivateButton">Activar</button>
                </div>
            </div>
        </div>
    </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function convertDateFormat(dateStr) {
        const dateParts = dateStr.split(" ");
        const month = dateParts[0]; // Ejemplo: Nov.
        const day = parseInt(dateParts[1], 10); // Ejemplo: 2
        const year = parseInt(dateParts[2], 10); // Ejemplo: 2024

        const months = {
            "Jan.": "01", "Feb.": "02", "Mar.": "03", "Apr.": "04",
            "May": "05", "Jun.": "06", "Jul.": "07", "Aug.": "08",
            "Sep.": "09", "Oct.": "10", "Nov.": "11", "Dec.": "12"
        };

        return `${day < 10 ? '0' + day : day}/${months[month]}/${year}`;
    }

    function filterRutas() {
        const input = document.getElementById("searchDate").value;
        const table = document.getElementById("routesTable");
        const rows = table.getElementsByTagName("tr");
    
        for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName("td");
            const dateCell = cells[1] || {};
            const dateValue = dateCell.textContent || dateCell.innerText;
    
            // Asegﾃｺrate de que esta conversiﾃｳn sea correcta
            const formattedDate = convertDateFormat(dateValue);
    
            // Si el valor no se encuentra en la fecha, ocultamos la fila
            if (formattedDate.indexOf(input) > -1) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    }
    

    function setDeleteForm(routeId, actionUrl) {
        document.getElementById('routeId').textContent = routeId;
        document.getElementById('deleteForm').action = actionUrl;
    }

    // Mostrar la alerta de ﾃｩxito
    function showSuccessAlert() {
        const successAlert = document.getElementById('successAlert');
        successAlert.style.display = 'block';
        setTimeout(() => {
            successAlert.style.display = 'none';
        }, 3000); // Ocultar despuﾃｩs de 3 segundos
    }

    // Llama a la funciﾃｳn si hay ﾃｩxito
    window.onload = function() {
        {% if messages %}
            showSuccessAlert();
        {% endif %}
    };


    const costaRicaLocations = {
        "San Josﾃｩ": {
            cantons: {
                "San Josﾃｩ": [
                    "Carmen", "Merced", "Hospital", "Catedral", "Zapote",
                    "San Francisco de Dos Rﾃｭos", "Uruca", "Mata Redonda", 
                    "Pavas", "Hatillo", "San Sebastiﾃ｡n"
                ],
                "Escazﾃｺ": ["Escazﾃｺ", "San Antonio", "San Rafael"],
                "Desamparados": [
                    "Desamparados", "San Miguel", "San Juan de Dios", 
                    "San Rafael Arriba", "San Antonio", "Frailes", 
                    "Patarra", "San Cristobal", "Rosario", "Damas", 
                    "San Rafael Abajo", "Gravilias", "Los Guido"
                ],
                "Puriscal": [
                    "Santiago", "Mercedes Sur", "Barbacoas", "Grifo Alto",
                    "San Rafael", "Candelarita", "Desamparaditos", 
                    "San Antonio", "Chires"
                ],
                "Tarrazﾃｺ": ["San Marcos", "San Lorenzo", "San Carlos"],
                "Aserrﾃｭ": ["Aserrﾃｭ", "Tarbaca", "Vuelta de Jorco", "San Gabriel", "Legua", "Monterrey", "Salitrillos"],
                "Mora": ["Colﾃｳn", "Guayabo", "Tabarcia", "Piedras Negras", "Picagres", "Jaris", "Quitirrisﾃｭ"],
                "Goicoechea": ["Guadalupe", "San Francisco", "Calle Blancos", "Mata de Plﾃ｡tano", "Ipis", "Rancho Redondo", "Purral"],
                "Santa Ana": ["Santa Ana", "Salitral", "Pozos", "Uruca", "Piedades", "Brasil"],
                "Alajuelita": ["Alajuelita", "San Josecito", "San Antonio", "Concepciﾃｳn", "San Felipe"],
                "Vﾃ｡zquez de Coronado": ["San Isidro", "San Rafael", "Dulce Nombre de Jesﾃｺs", "Patalillo", "Cascajal"],
                "Acosta": ["San Ignacio", "Guaitil", "Palmichal", "Cangrejal", "Sabanillas"],
                "Tibﾃ｡s": ["San Juan", "Cinco Esquinas", "Anselmo Llorente", "Leﾃｳn XIII", "Colima"],
                "Moravia": ["San Vicente", "San Jerﾃｳnimo", "La Trinidad"],
                "Montes de Oca": ["San Pedro", "Sabanilla", "Mercedes", "San Rafael"],
                "Turrubares": ["San Pablo", "San Pedro", "San Juan de Mata", "San Luis", "Carara"],
                "Dota": ["Santa Marﾃｭa", "Jardﾃｭn", "Copey"],
                "Curridabat": ["Curridabat", "Granadilla", "Sﾃ｡nchez", "Tirrases"],
                "Pﾃｩrez Zeledﾃｳn": ["San Isidro de El General", "El General", "Daniel Flores", "Rivas", "San Pedro", "Platanares", "Pejibaye", "Cajﾃｳn", "Barﾃｺ", "Rﾃｭo Nuevo", "Paramo", "La Amistad"],
                "Leﾃｳn Cortﾃｩs Castro": ["San Pablo", "San Andrﾃｩs", "Llano Bonito", "San Isidro", "Santa Cruz", "San Antonio"]
            }
        },
        "Alajuela": {
            cantons: {
                "Alajuela": [
                    "Alajuela", "San Josﾃｩ", "Carrizal", "San Antonio", 
                    "Guﾃ｡cima", "San Isidro", "Sabanilla", "San Rafael", 
                    "Rﾃｭo Segundo", "Desamparados", "Turrucares", 
                    "Tambor", "Garita", "Sarapiquﾃｭ"
                ],
                "San Ramﾃｳn": [
                    "San Ramﾃｳn", "Santiago", "San Juan", "Piedades Norte", 
                    "Piedades Sur", "San Rafael", "San Isidro", 
                    "ﾃ］geles", "Alfaro", "Volio", "Concepciﾃｳn", "Zapotal", 
                    "Peﾃｱas Blancas", "San Lorenzo"
                ],
                "Grecia": ["Grecia", "San Isidro", "San Josﾃｩ", "San Roque", "Tacares", "Puente de Piedra", "Bolivar"],
                "San Mateo": ["San Mateo", "Desmonte", "Jesﾃｺs Marﾃｭa", "Labrador"],
                "Atenas": ["Atenas", "Jesﾃｺs", "Mercedes", "San Isidro", "Concepciﾃｳn", "San Josﾃｩ", "Santa Eulalia", "Escobal"],
                "Naranjo": ["Naranjo", "San Miguel", "San Josﾃｩ", "Cirrﾃｭ Sur", "San Jerﾃｳnimo", "San Juan", "El Rosario", "Palmitos"],
                "Palmares": ["Palmares", "Zaragoza", "Buenos Aires", "Santiago", "Candelaria", "Esquipulas", "La Granja"],
                "Poﾃ｡s": ["San Pedro", "San Juan", "San Rafael", "Carrillos", "Sabana Redonda"],
                "Orotina": ["Orotina", "El Mastate", "Hacienda Vieja", "Coyolar", "La Ceiba"],
                "San Carlos": ["Quesada", "Florencia", "Buenavista", "Aguas Zarcas", "Venecia", "Pital", "La Fortuna", "La Tigra", "La Palmera", "Venado", "Cutris", "Monterrey", "Pocosol"],
                "Zarcero": ["Zarcero", "Laguna", "Tapesco", "Guadalupe", "Palmira", "Zapote", "Brisas"],
                "Sarchﾃｭ": ["Sarchﾃｭ Norte", "Sarchﾃｭ Sur", "Toro Amarillo", "San Pedro", "Rodrﾃｭguez"],
                "Upala": ["Upala", "Aguas Claras", "San Josﾃｩ O Pizote", "Bijagua", "Delicias", "Dos Rﾃｭos", "Yolillal", "Canalete"],
                "Los Chiles": ["Los Chiles", "Caﾃｱo Negro", "El Amparo", "San Jorge"],
                "Guatuso": ["San Rafael", "Buenavista", "Cote", "Katira"],
                "Rﾃｭo Cuarto": ["Rﾃｭo Cuarto", "Santa Rita", "Santa Isabel"]
            }
        },
        "Cartago": {
            cantons: {
                "Cartago": [
                    "Oriental", "Occidental", "Carmen", "San Nicolﾃ｡s", 
                    "Aguacaliente o San Francisco", "Guadalupe o Arenilla", 
                    "Corralillo", "Tierra Blanca", "Dulce Nombre", 
                    "Llano Grande", "Quebradilla"
                ],
                "Paraﾃｭso": ["Paraﾃｭso", "Santiago", "Orosi", "Cachﾃｭ", "Llanos de Santa Lucﾃｭa"],
                "La Uniﾃｳn": ["Tres Rﾃｭos", "San Diego", "San Juan", "San Rafael", "Concepciﾃｳn", "Dulce Nombre", "San Ramﾃｳn", "Rﾃｭo Azul"],
                "Jimﾃｩnez": ["Juan Viﾃｱas", "Tucurrique", "Pejibaye"],
                "Turrialba": ["Turrialba", "La Suiza", "Peralta", "Santa Cruz", "Santa Teresita", "Pavones", "Tuis", "Tayutic", "Santa Rosa", "Tres Equis", "La Isabel", "Chirripﾃｳ"],
                "Alvarado": ["Pacayas", "Cervantes", "Capellades"],
                "Oreamuno": ["San Rafael", "Cot", "Potrero Cerrado", "Cipreses", "Santa Rosa"],
                "El Guarco": ["El Tejar", "San Isidro", "Tobosi", "Patio de Agua"]
            }
        },
        "Heredia": {
            cantons: {
                "Heredia": [
                    "Heredia", "Mercedes", "San Francisco", "Ulloa", 
                    "Varablanca"
                ],
                "Barva": ["Barva", "San Pedro", "San Pablo", "San Roque", "Santa Lucﾃｭa", "San Josﾃｩ de la Montaﾃｱa"],
                "Santo Domingo": ["Santo Domingo", "San Vicente", "San Miguel", "Paracito", "Santo Tomﾃ｡s", "Santa Rosa", "Tures", "Parﾃ｡"],
                "Santa Bﾃ｡rbara": ["Santa Bﾃ｡rbara", "San Pedro", "San Juan", "Jesﾃｺs", "Santo Domingo", "Purabﾃ｡"],
                "San Rafael": ["San Rafael", "San Josecito", "Santiago", "ﾃ］geles", "Concepciﾃｳn"],
                "San Isidro": ["San Isidro", "San Josﾃｩ", "Concepciﾃｳn", "San Francisco"],
                "Belﾃｩn": ["San Antonio", "La Ribera", "La Asunciﾃｳn"],
                "Flores": ["San Joaquﾃｭn", "Barrantes", "Llorente"],
                "San Pablo": ["San Pablo", "Rincﾃｳn de Sabanilla"],
                "Sarapiquﾃｭ": ["Puerto Viejo", "La Virgen", "Las Horquetas", "Llanuras del Gaspar", "Cureﾃｱa"]
            }
        },
            "Guanacaste": {
            cantons: {
                "Liberia": ["Liberia", "Caﾃｱas Dulces", "Mayorga", "Nacascolo", "Curubandﾃｩ"],
                "Nicoya": ["Nicoya", "Mansiﾃｳn", "San Antonio", "Quebrada Honda", "Sﾃ｡mara", "Nosara", "Belﾃｩn de Nosarita"],
                "Santa Cruz": ["Santa Cruz", "Bolsﾃｳn", "Veintisiete de Abril", "Tempate", "Cartagena", "Cuajiniquil", "Diriﾃ｡", "Cabo Velas", "Tamarindo"],
                "Bagaces": ["Bagaces", "La Fortuna", "Mogote", "Rﾃｭo Naranjo"],
                "Carrillo": ["Filadelfia", "Palmira", "Sardinal", "Belﾃｩn"],
                "Caﾃｱas": ["Caﾃｱas", "Palmira", "San Miguel", "Bebedero", "Porozal"],
                "Abangares": ["Las Juntas", "Sierra", "San Juan", "Colorado"],
                "Tilarﾃ｡n": ["Tilarﾃ｡n", "Quebrada Grande", "Tronadora", "Santa Rosa", "Lﾃｭbano", "Tierras Morenas", "Arenal"],
                "Nandayure": ["Carmona", "Santa Rita", "Zapotal", "San Pablo", "Porvenir", "Bejuco"],
                "La Cruz": ["La Cruz", "Santa Cecilia", "La Garita", "Santa Elena"],
                "Hojancha": ["Hojancha", "Monte Romo", "Puerto Carrillo", "Huacas", "Matambﾃｺ"]
            }
        },
        "Puntarenas": {
            cantons: {
                "Puntarenas": [
                    "Puntarenas", "Pitahaya", "Chomes", "Lepanto", "Paquera", 
                    "Manzanillo", "Guacimal", "Barranca", "Isla del Coco", 
                    "Cﾃｳbano", "Chacarita", "Chira", "Acapulco", 
                    "El Roble", "Arancibia"
                ],
                "Esparza": ["Espﾃｭritu Santo", "San Juan Grande", "Macacona", "San Rafael", "San Jerﾃｳnimo", "Caldera"],
                "Buenos Aires": ["Buenos Aires", "Volcﾃ｡n", "Potrero Grande", "Boruca", "Pilas", "Colinas", "Chﾃ｡nguena", "Biolley", "Brunka"],
                "Montes de Oro": ["Miramar", "La Uniﾃｳn", "San Isidro"],
                "Osa": ["Puerto Cortﾃｩs", "Palmar", "Sierpe", "Bahﾃｭa Ballena", "Piedras Blancas", "Bahﾃｭa Drake"],
                "Quepos": ["Quepos", "Savegre", "Naranjito"],
                "Golfito": ["Golfito", "Puerto Jimﾃｩnez", "Guaycarﾃ｡", "Pavﾃｳn"],
                "Coto Brus": ["San Vito", "Sabalito", "Aguabuena", "Limoncito", "Pittier", "Gutiﾃｩrrez Braun"],
                "Parrita": ["Parrita"],
                "Corredores": ["Corredor", "La Cuesta", "Canoas", "Laurel"],
                "Garabito": ["Jacﾃｳ", "Tﾃ｡rcoles"],
                "Monteverde": ["Monteverde"]
            }
        },
        "Limﾃｳn": {
            cantons: {
                "Limﾃｳn": ["Limﾃｳn", "Valle La Estrella", "Rﾃｭo Blanco", "Matama"],
                "Pococﾃｭ": ["Guﾃ｡piles", "Jimﾃｩnez", "Rita", "Roxana", "Cariari", "Colorado", "La Colonia"],
                "Siquirres": ["Siquirres", "Pacuarito", "Florida", "Germania", "El Cairo", "Alegrﾃｭa", "Reventazﾃｳn"],
                "Talamanca": ["Bratsi", "Sixaola", "Cahuita", "Telire"],
                "Matina": ["Matina", "Batﾃ｡n", "Carrandﾃｭ"],
                "Guﾃ｡cimo": ["Guﾃ｡cimo", "Mercedes", "Pocora", "Rﾃｭo Jimﾃｩnez", "Duacarﾃｭ"]
            }
        }
    };
    
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Objeto de ubicaciones
        const costaRicaLocations = {
            "San Josﾃｩ": {
                cantons: {
                    "San Josﾃｩ": [
                        "Carmen", "Merced", "Hospital", "Catedral", "Zapote",
                        "San Francisco de Dos Rﾃｭos", "Uruca", "Mata Redonda", 
                        "Pavas", "Hatillo", "San Sebastiﾃ｡n"
                    ],
                    "Escazﾃｺ": ["Escazﾃｺ", "San Antonio", "San Rafael"],
                    "Desamparados": [
                        "Desamparados", "San Miguel", "San Juan de Dios", 
                        "San Rafael Arriba", "San Antonio", "Frailes", 
                        "Patarra", "San Cristobal", "Rosario", "Damas", 
                        "San Rafael Abajo", "Gravilias", "Los Guido"
                    ],
                    "Puriscal": [
                        "Santiago", "Mercedes Sur", "Barbacoas", "Grifo Alto",
                        "San Rafael", "Candelarita", "Desamparaditos", 
                        "San Antonio", "Chires"
                    ],
                    "Tarrazﾃｺ": ["San Marcos", "San Lorenzo", "San Carlos"],
                    "Aserrﾃｭ": ["Aserrﾃｭ", "Tarbaca", "Vuelta de Jorco", "San Gabriel", "Legua", "Monterrey", "Salitrillos"],
                    "Mora": ["Colﾃｳn", "Guayabo", "Tabarcia", "Piedras Negras", "Picagres", "Jaris", "Quitirrisﾃｭ"],
                    "Goicoechea": ["Guadalupe", "San Francisco", "Calle Blancos", "Mata de Plﾃ｡tano", "Ipis", "Rancho Redondo", "Purral"],
                    "Santa Ana": ["Santa Ana", "Salitral", "Pozos", "Uruca", "Piedades", "Brasil"],
                    "Alajuelita": ["Alajuelita", "San Josecito", "San Antonio", "Concepciﾃｳn", "San Felipe"],
                    "Vﾃ｡zquez de Coronado": ["San Isidro", "San Rafael", "Dulce Nombre de Jesﾃｺs", "Patalillo", "Cascajal"],
                    "Acosta": ["San Ignacio", "Guaitil", "Palmichal", "Cangrejal", "Sabanillas"],
                    "Tibﾃ｡s": ["San Juan", "Cinco Esquinas", "Anselmo Llorente", "Leﾃｳn XIII", "Colima"],
                    "Moravia": ["San Vicente", "San Jerﾃｳnimo", "La Trinidad"],
                    "Montes de Oca": ["San Pedro", "Sabanilla", "Mercedes", "San Rafael"],
                    "Turrubares": ["San Pablo", "San Pedro", "San Juan de Mata", "San Luis", "Carara"],
                    "Dota": ["Santa Marﾃｭa", "Jardﾃｭn", "Copey"],
                    "Curridabat": ["Curridabat", "Granadilla", "Sﾃ｡nchez", "Tirrases"],
                    "Pﾃｩrez Zeledﾃｳn": ["San Isidro de El General", "El General", "Daniel Flores", "Rivas", "San Pedro", "Platanares", "Pejibaye", "Cajﾃｳn", "Barﾃｺ", "Rﾃｭo Nuevo", "Paramo", "La Amistad"],
                    "Leﾃｳn Cortﾃｩs Castro": ["San Pablo", "San Andrﾃｩs", "Llano Bonito", "San Isidro", "Santa Cruz", "San Antonio"]
                }
            },
            "Alajuela": {
                cantons: {
                    "Alajuela": [
                        "Alajuela", "San Josﾃｩ", "Carrizal", "San Antonio", 
                        "Guﾃ｡cima", "San Isidro", "Sabanilla", "San Rafael", 
                        "Rﾃｭo Segundo", "Desamparados", "Turrucares", 
                        "Tambor", "Garita", "Sarapiquﾃｭ"
                    ],
                    "San Ramﾃｳn": [
                        "San Ramﾃｳn", "Santiago", "San Juan", "Piedades Norte", 
                        "Piedades Sur", "San Rafael", "San Isidro", 
                        "ﾃ］geles", "Alfaro", "Volio", "Concepciﾃｳn", "Zapotal", 
                        "Peﾃｱas Blancas", "San Lorenzo"
                    ],
                    "Grecia": ["Grecia", "San Isidro", "San Josﾃｩ", "San Roque", "Tacares", "Puente de Piedra", "Bolivar"],
                    "San Mateo": ["San Mateo", "Desmonte", "Jesﾃｺs Marﾃｭa", "Labrador"],
                    "Atenas": ["Atenas", "Jesﾃｺs", "Mercedes", "San Isidro", "Concepciﾃｳn", "San Josﾃｩ", "Santa Eulalia", "Escobal"],
                    "Naranjo": ["Naranjo", "San Miguel", "San Josﾃｩ", "Cirrﾃｭ Sur", "San Jerﾃｳnimo", "San Juan", "El Rosario", "Palmitos"],
                    "Palmares": ["Palmares", "Zaragoza", "Buenos Aires", "Santiago", "Candelaria", "Esquipulas", "La Granja"],
                    "Poﾃ｡s": ["San Pedro", "San Juan", "San Rafael", "Carrillos", "Sabana Redonda"],
                    "Orotina": ["Orotina", "El Mastate", "Hacienda Vieja", "Coyolar", "La Ceiba"],
                    "San Carlos": ["Quesada", "Florencia", "Buenavista", "Aguas Zarcas", "Venecia", "Pital", "La Fortuna", "La Tigra", "La Palmera", "Venado", "Cutris", "Monterrey", "Pocosol"],
                    "Zarcero": ["Zarcero", "Laguna", "Tapesco", "Guadalupe", "Palmira", "Zapote", "Brisas"],
                    "Sarchﾃｭ": ["Sarchﾃｭ Norte", "Sarchﾃｭ Sur", "Toro Amarillo", "San Pedro", "Rodrﾃｭguez"],
                    "Upala": ["Upala", "Aguas Claras", "San Josﾃｩ O Pizote", "Bijagua", "Delicias", "Dos Rﾃｭos", "Yolillal", "Canalete"],
                    "Los Chiles": ["Los Chiles", "Caﾃｱo Negro", "El Amparo", "San Jorge"],
                    "Guatuso": ["San Rafael", "Buenavista", "Cote", "Katira"],
                    "Rﾃｭo Cuarto": ["Rﾃｭo Cuarto", "Santa Rita", "Santa Isabel"]
                }
            },
            "Cartago": {
                cantons: {
                    "Cartago": [
                        "Oriental", "Occidental", "Carmen", "San Nicolﾃ｡s", 
                        "Aguacaliente o San Francisco", "Guadalupe o Arenilla", 
                        "Corralillo", "Tierra Blanca", "Dulce Nombre", 
                        "Llano Grande", "Quebradilla"
                    ],
                    "Paraﾃｭso": ["Paraﾃｭso", "Santiago", "Orosi", "Cachﾃｭ", "Llanos de Santa Lucﾃｭa"],
                    "La Uniﾃｳn": ["Tres Rﾃｭos", "San Diego", "San Juan", "San Rafael", "Concepciﾃｳn", "Dulce Nombre", "San Ramﾃｳn", "Rﾃｭo Azul"],
                    "Jimﾃｩnez": ["Juan Viﾃｱas", "Tucurrique", "Pejibaye"],
                    "Turrialba": ["Turrialba", "La Suiza", "Peralta", "Santa Cruz", "Santa Teresita", "Pavones", "Tuis", "Tayutic", "Santa Rosa", "Tres Equis", "La Isabel", "Chirripﾃｳ"],
                    "Alvarado": ["Pacayas", "Cervantes", "Capellades"],
                    "Oreamuno": ["San Rafael", "Cot", "Potrero Cerrado", "Cipreses", "Santa Rosa"],
                    "El Guarco": ["El Tejar", "San Isidro", "Tobosi", "Patio de Agua"]
                }
            },
            "Heredia": {
                cantons: {
                    "Heredia": [
                        "Heredia", "Mercedes", "San Francisco", "Ulloa", 
                        "Varablanca"
                    ],
                    "Barva": ["Barva", "San Pedro", "San Pablo", "San Roque", "Santa Lucﾃｭa", "San Josﾃｩ de la Montaﾃｱa"],
                    "Santo Domingo": ["Santo Domingo", "San Vicente", "San Miguel", "Paracito", "Santo Tomﾃ｡s", "Santa Rosa", "Tures", "Parﾃ｡"],
                    "Santa Bﾃ｡rbara": ["Santa Bﾃ｡rbara", "San Pedro", "San Juan", "Jesﾃｺs", "Santo Domingo", "Purabﾃ｡"],
                    "San Rafael": ["San Rafael", "San Josecito", "Santiago", "ﾃ］geles", "Concepciﾃｳn"],
                    "San Isidro": ["San Isidro", "San Josﾃｩ", "Concepciﾃｳn", "San Francisco"],
                    "Belﾃｩn": ["San Antonio", "La Ribera", "La Asunciﾃｳn"],
                    "Flores": ["San Joaquﾃｭn", "Barrantes", "Llorente"],
                    "San Pablo": ["San Pablo", "Rincﾃｳn de Sabanilla"],
                    "Sarapiquﾃｭ": ["Puerto Viejo", "La Virgen", "Las Horquetas", "Llanuras del Gaspar", "Cureﾃｱa"]
                }
            },
                "Guanacaste": {
                cantons: {
                    "Liberia": ["Liberia", "Caﾃｱas Dulces", "Mayorga", "Nacascolo", "Curubandﾃｩ"],
                    "Nicoya": ["Nicoya", "Mansiﾃｳn", "San Antonio", "Quebrada Honda", "Sﾃ｡mara", "Nosara", "Belﾃｩn de Nosarita"],
                    "Santa Cruz": ["Santa Cruz", "Bolsﾃｳn", "Veintisiete de Abril", "Tempate", "Cartagena", "Cuajiniquil", "Diriﾃ｡", "Cabo Velas", "Tamarindo"],
                    "Bagaces": ["Bagaces", "La Fortuna", "Mogote", "Rﾃｭo Naranjo"],
                    "Carrillo": ["Filadelfia", "Palmira", "Sardinal", "Belﾃｩn"],
                    "Caﾃｱas": ["Caﾃｱas", "Palmira", "San Miguel", "Bebedero", "Porozal"],
                    "Abangares": ["Las Juntas", "Sierra", "San Juan", "Colorado"],
                    "Tilarﾃ｡n": ["Tilarﾃ｡n", "Quebrada Grande", "Tronadora", "Santa Rosa", "Lﾃｭbano", "Tierras Morenas", "Arenal"],
                    "Nandayure": ["Carmona", "Santa Rita", "Zapotal", "San Pablo", "Porvenir", "Bejuco"],
                    "La Cruz": ["La Cruz", "Santa Cecilia", "La Garita", "Santa Elena"],
                    "Hojancha": ["Hojancha", "Monte Romo", "Puerto Carrillo", "Huacas", "Matambﾃｺ"]
                }
            },
            "Puntarenas": {
                cantons: {
                    "Puntarenas": [
                        "Puntarenas", "Pitahaya", "Chomes", "Lepanto", "Paquera", 
                        "Manzanillo", "Guacimal", "Barranca", "Isla del Coco", 
                        "Cﾃｳbano", "Chacarita", "Chira", "Acapulco", 
                        "El Roble", "Arancibia"
                    ],
                    "Esparza": ["Espﾃｭritu Santo", "San Juan Grande", "Macacona", "San Rafael", "San Jerﾃｳnimo", "Caldera"],
                    "Buenos Aires": ["Buenos Aires", "Volcﾃ｡n", "Potrero Grande", "Boruca", "Pilas", "Colinas", "Chﾃ｡nguena", "Biolley", "Brunka"],
                    "Montes de Oro": ["Miramar", "La Uniﾃｳn", "San Isidro"],
                    "Osa": ["Puerto Cortﾃｩs", "Palmar", "Sierpe", "Bahﾃｭa Ballena", "Piedras Blancas", "Bahﾃｭa Drake"],
                    "Quepos": ["Quepos", "Savegre", "Naranjito"],
                    "Golfito": ["Golfito", "Puerto Jimﾃｩnez", "Guaycarﾃ｡", "Pavﾃｳn"],
                    "Coto Brus": ["San Vito", "Sabalito", "Aguabuena", "Limoncito", "Pittier", "Gutiﾃｩrrez Braun"],
                    "Parrita": ["Parrita"],
                    "Corredores": ["Corredor", "La Cuesta", "Canoas", "Laurel"],
                    "Garabito": ["Jacﾃｳ", "Tﾃ｡rcoles"],
                    "Monteverde": ["Monteverde"]
                }
            },
            "Limﾃｳn": {
                cantons: {
                    "Limﾃｳn": ["Limﾃｳn", "Valle La Estrella", "Rﾃｭo Blanco", "Matama"],
                    "Pococﾃｭ": ["Guﾃ｡piles", "Jimﾃｩnez", "Rita", "Roxana", "Cariari", "Colorado", "La Colonia"],
                    "Siquirres": ["Siquirres", "Pacuarito", "Florida", "Germania", "El Cairo", "Alegrﾃｭa", "Reventazﾃｳn"],
                    "Talamanca": ["Bratsi", "Sixaola", "Cahuita", "Telire"],
                    "Matina": ["Matina", "Batﾃ｡n", "Carrandﾃｭ"],
                    "Guﾃ｡cimo": ["Guﾃ｡cimo", "Mercedes", "Pocora", "Rﾃｭo Jimﾃｩnez", "Duacarﾃｭ"]
                }
            }
        };

        // Inicializar las provincias en el dropdown
        const provincias = Object.keys(costaRicaLocations);
        provincias.forEach(function(provincia) {
            document.getElementById("provincia").innerHTML += `<option value="${provincia}">${provincia}</option>`;
        });

        // Manejar el cambio en la provincia
        document.getElementById("provincia").addEventListener("change", function() {
            const provincia = this.value;
            const cantones = provincia in costaRicaLocations ? Object.keys(costaRicaLocations[provincia].cantons) : [];
            
            // Limpiar y actualizar el dropdown de cantones
            const cantonSelect = document.getElementById("canton");
            cantonSelect.innerHTML = "<option value=''>Seleccione un cantﾃｳn</option>";
            cantones.forEach(function(canton) {
                cantonSelect.innerHTML += `<option value="${canton}">${canton}</option>`;
            });
            
            // Limpiar el dropdown de distritos
            document.getElementById("distrito").innerHTML = "<option value=''>Seleccione un distrito</option>";
        });

        // Manejar el cambio en el cantﾃｳn
        document.getElementById("canton").addEventListener("change", function() {
            const provincia = document.getElementById("provincia").value;
            const canton = this.value;
            const distritos = provincia && canton && costaRicaLocations[provincia].cantons[canton] ? costaRicaLocations[provincia].cantons[canton] : [];

            // Limpiar y actualizar el dropdown de distritos
            const distritoSelect = document.getElementById("distrito");
            distritoSelect.innerHTML = "<option value=''>Seleccione un distrito</option>";
            distritos.forEach(function(distrito) {
                distritoSelect.innerHTML += `<option value="${distrito}">${distrito}</option>`;
            });
        });
    });


    function printRutas() {
        // Obtener la tabla de rutas
        const table = document.getElementById("routesTable").outerHTML;
    
        // Crear una nueva ventana para imprimir
        const printWindow = window.open("", "_blank");
    
        // Formato de la pﾃ｡gina de impresiﾃｳn
        printWindow.document.write(`
            <html>
            <head>
                <title></title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
                <style>
                    h1 { text-align: center; margin-top: 20px; }
                    .table th, .table td { border: 1px solid #dee2e6; padding: 8px; }
                    .table th { background-color: #007bff; color: white; }
                </style>
            </head>
            <body>
                <h1>Listado de Rutas</h1>
                <p>Fecha de impresiﾃｳn: ${new Date().toLocaleDateString("es-ES")}</p>
                ${table}
            </body>
            </html>
        `);
    
        // Cerrar el documento de la ventana y activar la impresiﾃｳn
        printWindow.document.close();
        printWindow.print();
    }
    
</script>

<script>
    //Gestionar el filtro de cantidad de conductores mostrados
    document.addEventListener('DOMContentLoaded', function () {
        const filasTabla = document.getElementById('filasTabla');
        const tablaCuerpo = document.querySelector('#routesTable tbody');
        const filas = Array.from(tablaCuerpo.querySelectorAll('tr'));

        // Funciﾃｳn para actualizar la cantidad de filas visibles
        function actualizarFilas() {
            const cantidad = parseInt(filasTabla.value, 10);

            // Mostrar solo las filas seleccionadas
            filas.forEach((fila, index) => {
                if (index < cantidad) {
                    fila.style.display = ''; // Mostrar
                } else {
                    fila.style.display = 'none'; // Ocultar
                }
            });
        }

        // Actualizar filas cuando cambie el valor del desplegable
        filasTabla.addEventListener('change', actualizarFilas);

        // Mostrar solo las filas seleccionadas al cargar la pﾃ｡gina
        actualizarFilas();
    });
</script>

<script>
    let rutaIdToDelete = null;

    function eliminarRuta(idRuta) {
        if (confirm('ﾂｿEstﾃ｡s seguro de que deseas desactivar esta ruta?')) {
            fetch(`/transportes/eliminar_ruta/${idRuta}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({})
            })
            .then(response => {
                if (response.ok) {
                    location.reload(); // 沐 Recarga la pﾃ｡gina para reflejar los cambios
                } else {
                    alert('Error al desactivar la ruta');
                }
            })
            .catch(error => alert('Error de conexiﾃｳn'));
        }
    }
    

    
    function generatePDF() {
        // Obtener la tabla de rutas (solo las filas que necesitas)
        const table = document.getElementById("routesTable");
        const tableRows = table.querySelectorAll("tbody tr");
    
        // Cargar la librerﾃｭa jsPDF
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('landscape');
    
        // Agregar el logo
        const logoPath = '/static/img/logo.jpg'; // Cambia esta ruta al logo que estﾃ｡s usando
        doc.addImage(logoPath, 'JPEG', 10, 10, 30, 30); // X, Y, Ancho, Alto
    
        // Agregar el tﾃｭtulo y la fecha
        doc.setFont("helvetica", "bold");
        doc.setFontSize(22);
        doc.text('Listado de Rutas', 210, 20, null, null, 'right'); // Centrado en formato horizontal
        
        doc.setFontSize(12);
        doc.text('Fecha de impresiﾃｳn: ' + new Date().toLocaleDateString("es-ES")+"_"+ new Date().toLocaleTimeString("es-ES"), 210, 30, null, null, 'right');

        // Establecer los bordes de la tabla
        doc.setDrawColor(0, 0, 0);  // Color de la lﾃｭnea de la tabla (negro)
        doc.setLineWidth(0.1);  // Ancho de la lﾃｭnea

        // Definir el inicio de las celdas
        let y = 50;  // Empieza debajo de los encabezados

        // Aﾃｱadir encabezado de la tabla
        doc.setFontSize(10);
        doc.setTextColor(0, 0, 0);  // Color de texto azul
        doc.text('ID Ruta', 10, y);
        doc.text('Fecha', 40, y);
        doc.text('Provincia', 70, y);
        doc.text('Cantﾃｳn', 110, y);
        doc.text('Distrito', 150, y);
        doc.text('Direcciﾃｳn Exacta', 190, y); // Direcciﾃｳn Exacta con mayor espacio
        doc.text('Conductor', 250, y);
        doc.text('Vehﾃｭculo', 300, y);

        // Aumentar la posiciﾃｳn vertical para las filas de la tabla
        y += 10;

        // Aﾃｱadir las filas de la tabla
        tableRows.forEach(row => {
            const cells = row.querySelectorAll('td');

            // Verificar si la fila debe tener el color de fondo gris (Inactivo)
            const isInactive = row.getAttribute('data-estado') === 'false'; // Asegﾃｺrate de que esta sea la forma correcta de identificar el estado

            // Si es Inactivo, aplicar un fondo gris
            if (isInactive) {
                doc.setFillColor(211, 211, 211); // Gris claro
                doc.rect(5, y - 5, 35, 10, 'F'); // ID Ruta
                doc.rect(35, y - 5, 30, 10, 'F'); // Fecha
                doc.rect(65, y - 5, 40, 10, 'F'); // Provincia
                doc.rect(105, y - 5, 40, 10, 'F'); // Cantﾃｳn
                doc.rect(145, y - 5, 40, 10, 'F'); // Distrito
                doc.rect(185, y - 5, 60, 10, 'F'); // Direcciﾃｳn Exacta
                doc.rect(245, y - 5, 50, 10, 'F'); // Conductor
                doc.rect(295, y - 5, 50, 10, 'F'); // Vehﾃｭculo
            }

            // Dibujar las celdas de la tabla
            doc.setFillColor(255, 255, 255); // Color blanco para las celdas
            doc.text(cells[0].textContent, 10, y); // ID Ruta
            doc.text(cells[1].textContent, 40, y); // Fecha
            doc.text(cells[2].textContent, 70, y); // Provincia
            doc.text(cells[3].textContent, 110, y); // Cantﾃｳn
            doc.text(cells[4].textContent, 150, y); // Distrito

            // Ajustar Direcciﾃｳn Exacta para que ocupe todo el espacio disponible
            let direccionExacta = cells[5].textContent; // Direcciﾃｳn Exacta
            doc.setFontSize(8); // Reducir tamaﾃｱo de fuente para ajustarlo
            doc.text(direccionExacta, 190, y, { maxWidth: 50, lineHeightFactor: 1.2 });  // Limitar el ancho de la columna y ajustar el texto

            doc.text(cells[6].textContent, 250, y); // Conductor
            doc.text(cells[7].textContent, 300, y); // Vehﾃｭculo

            // Dibujar las lﾃｭneas de la tabla
            doc.setDrawColor(0, 0, 0); // Color negro para las lﾃｭneas
            doc.rect(5, y - 5, 35, 10); // ID Ruta
            doc.rect(35, y - 5, 30, 10); // Fecha
            doc.rect(65, y - 5, 40, 10); // Provincia
            doc.rect(105, y - 5, 40, 10); // Cantﾃｳn
            doc.rect(145, y - 5, 40, 10); // Distrito
            doc.rect(185, y - 5, 60, 10); // Direcciﾃｳn Exacta
            doc.rect(245, y - 5, 50, 10); // Conductor
            doc.rect(295, y - 5, 50, 10); // Vehﾃｭculo

            // Aumentar la posiciﾃｳn vertical para la siguiente fila
            y += 12;

            // Si el contenido se acerca al final de la pﾃ｡gina, agrega una nueva pﾃ｡gina
            if (y > 270) { // El lﾃｭmite de la pﾃ｡gina horizontal es 270 para no cortar el contenido
                doc.addPage();
                y = 20;  // Reiniciar la posiciﾃｳn en la nueva pﾃ｡gina

                // Volver a agregar el encabezado en cada nueva pﾃ｡gina
                doc.text('Listado de Rutas', 210, 20, null, null, 'center');
                doc.text('Fecha de impresiﾃｳn: ' + new Date().toLocaleDateString("es-ES"), 210, 30, null, null, 'center');

                // Reimprimir los encabezados de la tabla
                doc.text('ID Ruta', 10, y);
                doc.text('Fecha', 40, y);
                doc.text('Provincia', 70, y);
                doc.text('Cantﾃｳn', 110, y);
                doc.text('Distrito', 150, y);
                doc.text('Direcciﾃｳn Exacta', 190, y); // Direcciﾃｳn Exacta con mayor espacio
                doc.text('Conductor', 250, y);
                doc.text('Vehﾃｭculo', 300, y);

                // Aumentar la posiciﾃｳn para las filas de la tabla
                y += 10;
            }
        });

        // Agregar las firmas al final de la tabla
        doc.setFontSize(12);
        doc.text('Firma del encargado: _____________________________', 10, y);
        y += 10;
        doc.text('Firma del Conductor: _____________________________', 10, y);

        // Guardar el PDF con la fecha en el nombre
        const date = new Date();
        const fileName = `Listado_Rutas_${date.getDate()}_${date.getMonth() + 1}_${date.getFullYear()}.pdf`;
        doc.save(fileName);
    }
    

    

</script>



<script>
let rutaIdToActivate = null;

function activarRuta(idRuta) {
    if (confirm('ﾂｿEstﾃ｡s seguro de que deseas activar esta ruta?')) {
        fetch(`/transportes/activar_ruta/${idRuta}/`, {
            method: 'POST',  // 沐ｹ Debe ser POST, no GET
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload(); // Recargar la pﾃ｡gina para reflejar cambios
            } else {
                alert('Hubo un error al activar la ruta.');
            }
        })
        .catch(error => alert('Error de conexiﾃｳn'));
    }
}




</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("filtroEstado").addEventListener("change", function () {
            var estadoSeleccionado = this.value;
            var filas = document.querySelectorAll("#routesTable tbody tr");
    
            filas.forEach(function (fila) {
                var estado = fila.getAttribute("data-estado");
    
                // Normaliza los valores
                if (estado === "true") estado = "activo";
                if (estado === "false") estado = "inactivo";
    
                // Filtra segﾃｺn el estado seleccionado
                if (estadoSeleccionado === "todos") {
                    fila.style.display = "";  // Mostrar todas
                } else if (estadoSeleccionado === "activos" && estado === "activo") {
                    fila.style.display = "";  // Mostrar solo activas
                } else if (estadoSeleccionado === "inactivos" && estado === "inactivo") {
                    fila.style.display = "";  // Mostrar solo inactivas
                } else {
                    fila.style.display = "none";  // Ocultar las que no coinciden
                }
            });
        });
    });
    
    <script>
        function eliminarRuta(id) {
            document.getElementById('confirmDeleteBtn').setAttribute('onclick', `confirmarEliminacion(${id})`);
            var myModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            myModal.show();
        }
        
        function activarRuta(id) {
            document.getElementById('confirmActivateBtn').setAttribute('onclick', `confirmarActivacion(${id})`);
            var myModal = new bootstrap.Modal(document.getElementById('confirmActivateModal'));
            myModal.show();
        }
        
        function confirmarEliminacion(id) {
            // Aquﾃｭ debes hacer la peticiﾃｳn para eliminar la ruta
            console.log('Eliminando ruta con ID:', id);
        }
        
        function confirmarActivacion(id) {
            // Aquﾃｭ debes hacer la peticiﾃｳn para activar la ruta
            console.log('Activando ruta con ID:', id);
        }
        
    </script>




{% endblock %}
