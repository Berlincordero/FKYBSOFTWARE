{% extends 'base.html' %} {% block content %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Proformas</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <style>
      body {
        background-color: #d3d3d3;
        font-family: Arial, sans-serif;
      }
      .container {
        width: 80%;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-top: 50px;
      }
      .title-with-icon {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      .title-with-icon i {
        margin-right: 10px;
        font-size: 2em;
      }
      .title-with-icon h1 {
        margin: 0;
        font-size: 2em;
      }
      .search-container {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }
      .search-container input {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
        margin-right: 10px;
      }
      .search-container button {
        background-color: #4caf50;
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .header,
      .form-group,
      .line-details,
      .buttons,
      .totals {
        margin: 20px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input[type="text"],
      select {
        margin-top: 15px;
        width: 40%;
        padding: 8px;
        margin-bottom: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
      .save-proforma,
      .create-proforma {
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      .action-icons i {
        cursor: pointer;
        margin-right: 10px;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="title-with-icon">
        <i class="fa fa-file-invoice-dollar"></i>
        <h1>Lista de Proformas</h1>
      </div>
      <div class="search-container">
        <input type="text" id="search" placeholder="Buscar proforma..." />
        <button><i class="fa fa-search"></i></button>
        <button><i class="fa fa-filter"></i></button>
      </div>
      <button class="create-proforma" onclick="openProformaModal()">
        Crear Proforma
      </button>
    </div>

    <div class="proforma-list" style="width: 80%; margin: 20px auto">
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Código Actividad Económica</th>
            <th>Medio de Pago</th>
            <th>Condición de Venta</th>
            <th>Detalles</th>
            <th>Nota</th>
            <th>Total</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="proforma-table-body"></tbody>
      </table>
    </div>

    <div id="proformaModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h1>Proforma</h1>
        <div class="header">
          <div class="header-left">
            <p>Fecha: <span id="fecha-proforma">2024-07-18</span></p>
            <p>Moneda: CRC</p>
          </div>
          <div class="header-right">
            <p>
              Venta al por menor artículos de ferretería pinturas madera y
              materiales para la construcción
            </p>
          </div>
        </div>
        <div class="form-group">
          <label for="cliente">Cliente:</label>
          <input
            type="text"
            id="cliente"
            placeholder="Busca por nombre, cédula o teléfono"
          />
        </div>
        <div class="form-group">
          <label for="Código-actividad-económica"
            >Código-actividad-económica:</label
          >
          <select id="Código-actividad-económica">
            <option value="regular">regular</option>
            <!-- other options -->
          </select>
        </div>
        <div class="form-group">
          <label for="medio-pago">Medio de pago:</label>
          <select id="medio-pago">
            <option value="efectivo">Efectivo</option>
            <!-- other options -->
          </select>
          <label for="condicion-venta">Condición de venta:</label>
          <select id="condicion-venta">
            <option value="contado">Contado</option>
            <!-- other options -->
          </select>
        </div>
        <h2>Detalle de líneas</h2>
        <div class="line-details">
          <input
            type="text"
            id="product-details"
            placeholder="Código / Nombre del producto"
          />
          <button class="add-line">AGREGAR LÍNEA</button>
        </div>
        <div class="line-table">
          <table>
            <thead>
              <tr>
                <th>Cant.</th>
                <th>Unidad</th>
                <th>Prec. Unid.</th>
                <th>Desc %</th>
                <th>Subtotal</th>
                <th>IVA</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="line-table-body"></tbody>
          </table>
        </div>
        <h2>Notas</h2>
        <div class="line-details">
          <input type="text" id="nota" placeholder="Agregar una Nota" />
          <button class="add-line">AGREGAR NOTA</button>
        </div>
        <div class="buttons">
          <button class="extra-info">AGREGAR INFORMACIÓN EXTRA</button>
          <button class="other-charge">AGREGAR OTRO CARGO</button>
          <button class="add-reference">AGREGAR REFERENCIA</button>
        </div>
        <div class="totals">
          <p>Total Impuesto: <span id="total-impuesto">0.00</span></p>
          <p>Total Comprobante: <span id="total-comprobante">0.00</span></p>
        </div>
        <button class="save-proforma" onclick="saveProforma()">
          GUARDAR PROFORMA
        </button>
      </div>
    </div>

    <div id="viewProformaModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h1>Vista de Proforma</h1>
        <div id="proforma-details"></div>
      </div>
    </div>

    <div id="deleteConfirmModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Confirmación</h2>
        <p>¿Está seguro de que desea eliminar esta proforma?</p>
        <button id="confirmDeleteButton">Aceptar</button>
      </div>
    </div>

    <script>
      var modal = document.getElementById("proformaModal");
      var spans = document.getElementsByClassName("close");
      var viewModal = document.getElementById("viewProformaModal");
      var deleteConfirmModal = document.getElementById("deleteConfirmModal");
      var deleteConfirmButton = document.getElementById("confirmDeleteButton");
      var deleteElement = null;

      function openProformaModal() {
        modal.style.display = "block";
      }

      for (var i = 0; i < spans.length; i++) {
        spans[i].onclick = function () {
          modal.style.display = "none";
          viewModal.style.display = "none";
          deleteConfirmModal.style.display = "none";
        };
      }

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
        if (event.target == viewModal) {
          viewModal.style.display = "none";
        }
        if (event.target == deleteConfirmModal) {
          deleteConfirmModal.style.display = "none";
        }
      };

      function saveProforma() {
        const cliente = document.getElementById("cliente").value;
        const total = document.getElementById("total-comprobante").innerText;
        const fecha = new Date().toISOString().split("T")[0];
        const codigoActividad = document.getElementById(
          "Código-actividad-económica"
        ).value;
        const medioPago = document.getElementById("medio-pago").value;
        const condicionVenta = document.getElementById("condicion-venta").value;
        const detalles = document.getElementById("product-details").value;
        const nota = document.getElementById("nota").value;

        if (cliente && total) {
          const tableBody = document.getElementById("proforma-table-body");
          const newRow = document.createElement("tr");

          const fechaCell = document.createElement("td");
          const clienteCell = document.createElement("td");
          const codigoActividadCell = document.createElement("td");
          const medioPagoCell = document.createElement("td");
          const condicionVentaCell = document.createElement("td");
          const detallesCell = document.createElement("td");
          const notaCell = document.createElement("td");
          const totalCell = document.createElement("td");
          const actionsCell = document.createElement("td");

          fechaCell.innerText = fecha;
          clienteCell.innerText = cliente;
          codigoActividadCell.innerText = codigoActividad;
          medioPagoCell.innerText = medioPago;
          condicionVentaCell.innerText = condicionVenta;
          detallesCell.innerText = detalles;
          notaCell.innerText = nota;
          totalCell.innerText = total;

          actionsCell.innerHTML = `
          <i class="fa fa-trash" onclick="confirmDeleteProforma(this)" title="Eliminar"></i>
          <i class="fa fa-eye" onclick="viewProforma('${fecha}', '${cliente}', '${codigoActividad}', '${medioPago}', '${condicionVenta}', '${detalles}', '${total}', '${nota}')" title="Visualizar"></i>
        `;

          newRow.appendChild(fechaCell);
          newRow.appendChild(clienteCell);
          newRow.appendChild(codigoActividadCell);
          newRow.appendChild(medioPagoCell);
          newRow.appendChild(condicionVentaCell);
          newRow.appendChild(detallesCell);
          newRow.appendChild(notaCell);
          newRow.appendChild(totalCell);
          newRow.appendChild(actionsCell);

          tableBody.appendChild(newRow);

          modal.style.display = "none";
          document.getElementById("cliente").value = "";
          document.getElementById("total-comprobante").innerText = "0.00";
        } else {
          alert("Por favor complete los campos requeridos");
        }
      }

      function confirmDeleteProforma(element) {
        deleteElement = element;
        deleteConfirmModal.style.display = "block";
      }

      deleteConfirmButton.onclick = function () {
        var row = deleteElement.parentNode.parentNode;
        row.parentNode.removeChild(row);
        deleteConfirmModal.style.display = "none";
      };

      function viewProforma(
        fecha,
        cliente,
        codigoActividad,
        medioPago,
        condicionVenta,
        detalles,
        total,
        nota
      ) {
        const proformaDetails = document.getElementById("proforma-details");
        proformaDetails.innerHTML = `
        <p><strong>Fecha:</strong> ${fecha}</p>
        <p><strong>Cliente:</strong> ${cliente}</p>
        <p><strong>Código Actividad Económica:</strong> ${codigoActividad}</p>
        <p><strong>Medio de Pago:</strong> ${medioPago}</p>
        <p><strong>Condición de Venta:</strong> ${condicionVenta}</p>
        <p><strong>Detalles:</strong> ${detalles}</p>
        <p><strong>Total:</strong> ${total}</p>
        <p><strong>Nota:</strong> ${nota}</p>
      `;
        viewModal.style.display = "block";
      }

      document.getElementById("search").addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll("#proforma-table-body tr");

        rows.forEach((row) => {
          const cells = row.getElementsByTagName("td");
          let match = false;

          for (let i = 0; i < cells.length; i++) {
            if (cells[i].innerText.toLowerCase().includes(searchTerm)) {
              match = true;
              break;
            }
          }

          row.style.display = match ? "" : "none";
        });
      });
    </script>
  </body>
</html>

{% endblock %}
