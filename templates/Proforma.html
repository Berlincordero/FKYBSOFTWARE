{% extends 'base.html' %} {% block content %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Proformas</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <style>
    
    


.container-proformas-kike {
        width: 80%;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-top: 50px;
        position: relative;
      }
      .title-with-icon {
        font-size: 18px;
        color: orange;
        font-size: 16px;
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }
      .title-with-icon i {
        margin-right: 10px;
        font-size: 2em;
      }
      .title-with-icon h1 {
        margin: 0;
        font-size: 2em;
      }
      .search-container {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        position: relative;
      }
      .search-container input {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
        margin-right: 10px;
      }
      .search-container .search-button {
        background-color: #4caf50;
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
      }
      
      .header,
      .form-group,
      .line-details,
      .buttons,
      .totals {
        margin: 20px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input[type="text"],
      select {
        margin-top: 15px;
        width: 40%;
        padding: 8px;
        margin-bottom: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      th,
      td {
        border: 1px solid #95defd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #95defd;
      }

      tbody tr:hover {
        background-color: hsl(180, 1%, 83%); /* Cambia el fondo de la fila al pasar el ratón */
        transition: background-color 0.3s; /* Para una transición suave */
    }
    
      tbody td:hover {
        background-color: #efc737; /* Cambia el fondo de la celda al pasar el ratón */
        transition: background-color 0.3s; /* Para una transición suave */
    }


      .save-proforma,
      .create-proforma {
        padding: 10px 20px;
        background-color: #3163f9;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
      }
      .modal-proforma {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }
      .action-icons i {
        background-color: #96c4f5;
        color: red;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
      }
      .fixed-icons {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
      }
      .fixed-icons button {
        background-color: #ffffff;
        border: 1px solid #ddd;
        color: #3163f9;
        padding: 8px;
        border-radius: 50%;
        margin-bottom: 10px;
        cursor: pointer;
        font-size: 1.5em;
      }
      .create-proforma {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #4caf50;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px;
        border-radius: 50%;
        font-size: 24px;
        color: white;
        width: 50px;
        height: 50px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }


      @media (min-width: 1200px) {
        .h1, h1 {
            margin: auto;
            color: orange;
            font-size: 2.5rem;
        }
    }
    .search-bar {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
  }
  
  .search-label {
      margin-bottom: 5px; /* Espacio entre la etiqueta y la barra de búsqueda */
      font-weight: bold;  /* Opcional: Negrita para la etiqueta */
  }
  
  .search-input-wrapper {
      display: flex;
      align-items: center;
  }
  
  .search-input-wrapper input[type="text"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      flex-grow: 1;
      margin-right: 10px;
  }
  
  .search-input-wrapper button {
      background-color: #4caf50;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  
  .icono-proforma-formulario {
      color: #826119e7
  }
  .moneda-unica {
    background-color: #e0f7fa; /* Color de fondo personalizado */
    border: 2px solid #00796b; /* Borde personalizado */
    color: #004d40; /* Color del texto */
    padding: 5px;
    font-family: Arial, sans-serif;
    border-radius: 5px;
    width: 150px; /* Ancho fijo */
    cursor: pointer;
}

.moneda-unica:focus {
    border-color: #004d40; /* Cambia el color del borde al enfocar */
    outline: none;
    box-shadow: 0 0 5px rgba(0, 77, 64, 0.5); /* Sombra al enfocar */
}

/* Contenedor de los iconos */
.action-icons {
    display: flex;
    justify-content: center; /* Centra los iconos horizontalmente */
    align-items: center; /* Centra los iconos verticalmente */
    gap: 15px; /* Espacio entre los iconos */
}

/* Estilos generales para los iconos */
.action-icons i {
    cursor: pointer;
    font-size: 20px;
    color: #555;
    transition: color 0.3s ease;
}

/* Cambia el color al pasar el mouse */
.action-icons i:hover {
    color: #007bff;
}

/* Efecto de presionado */
.action-icons i:active {
    transform: scale(0.95);
}

.buttons {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100px; /* Ajusta la altura según tu diseño */
}

.imprimir-proforma {
  font-size: 35px;
  color: #28a745;
  cursor: pointer;
  padding: 20px; /* Espacio alrededor del ícono */
  transition: all 0.3s ease;
  display: flex;
  justify-content: center;
  align-items: center;
}

////////////////////////////////

 
    </style>
  </head>
  <body>
    <div class="container-proformas-kike">
      <div class="title-with-icon">
        <i class="fa fa-file-invoice-dollar"></i>
        <h1>Proformas</h1>
      </div>
      <div class="search-container">
        <input type="text" id="search" placeholder="Buscar proforma..." />
        <button class="search-button"><i class="fa fa-search"></i></button>
      </div>

    </div>

    <div class="proforma-list" style="width: 100%; margin: 20px auto">
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Moneda</th>
            <th>Cliente</th>
            <th>Código Actividad Económica</th>
            <th>Medio de Pago</th>
            <th>Condición de Venta</th>
            <th>Detalles</th>
            <th>Nota</th>
            <th>Total</th>
            <th>Opciones</th>
          </tr>
        </thead>
        <tbody id="proforma-table-body"></tbody>
      </table>
    </div>

    <div id="proformaModal" class="modal-proforma">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h1><i class="fas fa-file-invoice  icono-proforma-formulario"></i> Proforma</h1>
        <div class="header">
          <div class="header-left">
            <input type="date" class="form-control" id="fecha_ingreso" name="fecha_ingreso">
            <select id="currency-select" name="currency" class="moneda-unica">
              <option value="CRC">CRC</option>
              <option value="USD">Dólares</option>
          </select>
          </div>
          <div class="header-right">
            <p>
              Venta al por menor artículos de ferretería pinturas madera y
              materiales para la construcción
            </p>
          </div>
        </div>
        <div class="form-group">
          <label for="cliente">Cliente:</label>
          <input
            type="text"
            id="cliente"
            placeholder="Busca por nombre, cédula o teléfono"
          />
        </div>
        <div class="form-group">
          <label for="Código-actividad-económica"
            >Código-actividad-económica:</label
          >
          <select id="Código-actividad-económica">
            <option value="regular">regular</option>
            <option value="especial">especial</option>
            <option value="exento">mayorista</option>
            <!-- other options -->
          </select>
        </div>
        <div class="form-group">
          <label for="medio-pago">Medio de pago:</label>
          <select id="medio-pago">
            <option value="efectivo">Efectivo</option>
            <option value="tarjeta">Tarjeta</option>
            <option value="transferencia">Transferencia</option>  
            <option value="cheque">Cheque</option>
            <option value="deposito">Depósito</option>
            <option value="otros">Otros</option>
            <!-- other options -->
          </select>
          <label for="condición-venta">Condición de venta:</label>
          <select id="condición-venta">
            <option value="contado">Contado</option>
            <option value="contado">Credito</option>
            <!-- other options -->
          </select>
        </div>
          <!-- Nuevos campos para Detalles y Nota -->
          <div class="form-group">
            <label for="detalles">Detalles:</label>
            <input
              type="text"
              id="detalles"
              placeholder="Detalles de la proforma"
            />
          </div>
          <div class="form-group">
            <label for="nota">Nota:</label>
            <input
              type="text"
              id="nota"
              placeholder="Nota adicional"
            />
          </div>
          
          <div class="search-bar">
            <label for="nota" class="search-label">Producto:</label>
            <div class="search-input-wrapper">
                <input type="text" id="nota" placeholder="Ingrese el nombre del producto">
                <button><i class="fa fa-search"></i></button>
            </div>
        </div>

        <div class="line-details">
          <h2>Detalles de línea</h2>
          <table id="line-items-table">
              <thead>
                  <tr>
                      <th>Código</th>
                      <th>Descripción</th>
                      <th>Cantidad</th>
                      <th>Unidad</th>
                      <th>Precio Unitario</th>
                      <th>Descuento</th>
                      <th>IVA</th>
                      <th>Total</th>
                      <th>Opciones</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>001</td>
                      <td>Producto 1</td>
                      <td><input type="number" value="10" min="1" onchange="updateTotal(this)"></td>
                      <td>unidad</td>
                      <td>1000</td>
                      <td><input type="number" value="" min="1" onchange="updateTotal(this)"></td>
                      <td>13%</td>
                      <td>1000</td>
                      <td class="action-icons">
                          <i class="fas fa-trash" onclick="eliminarFila(this)"></i>
                      </td>
                  </tr>
                  <!-- otras filas -->
              </tbody>
          </table>
      </div>
       
        <div class="totals">
          <h2>Totales</h2>
          <p>Subtotal: <span id="subtotal">1000</span></p>
          <p>Descuento: <span id="descuento">0</span></p>
          <p>IVA: <span id="iva">130</span></p>
          <p>Total Neto: <span id="total">1000</span></p>
        </div>
        <div class="buttons">
          <button class="save-proforma">Guardar</button>
        </div>
        <div class="buttons-imprimir-proforma">
          <i class="fas fa-print imprimir-proforma" onclick="imprimirProforma()"></i>
      </div>
      </div>
    </div>

    <button class="create-proforma"><i class="fa fa-plus"></i></button>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var modal = document.getElementById('proformaModal');
        var btn = document.querySelector('.create-proforma');
        var span = document.querySelector('.close');

        btn.onclick = function () {
          modal.style.display = 'block';
        };

        span.onclick = function () {
          modal.style.display = 'none';
        };

        window.onclick = function (event) {
          if (event.target == modal) {
            modal.style.display = 'none';
          }
        };

        document.querySelector('.save-proforma').onclick = function () {
          saveProforma();
        };
      });

      function saveProforma() {
        var cliente = document.getElementById('cliente').value;
        var codigoActividad = document.getElementById('Código-actividad-económica').value;
        var medioPago = document.getElementById('medio-pago').value;
        var condicionVenta = document.getElementById('condición-venta').value;
        var fecha = document.getElementById('fecha_ingreso').value; // Cambié el id a 'fecha_ingreso'
        var moneda = document.getElementById('currency-select').value;
        var detalles = document.getElementById('detalles').value;
        var nota = document.getElementById('nota').value;
        var total = document.getElementById('total').innerText;
    
        var tableBody = document.getElementById('proforma-table-body');
        var newRow = tableBody.insertRow();
        newRow.innerHTML = `
          <td>${fecha}</td>
          <td>${moneda}</td>
          <td>${cliente}</td>
          <td>${codigoActividad}</td>
          <td>${medioPago}</td>
          <td>${condicionVenta}</td>
          <td>${detalles}</td>
          <td>${nota}</td>
          <td>${total}</td>
          <td class="action-icons">
          <i class="fa fa-edit"></i>
          <i class="fa fa-trash" onclick="deleteRow(this)"></i>
          <i class="fa fa-file-invoice" onclick="convertToInvoice(this)" title="Convertir a Factura"></i>
          </td>
        `;
    
        var modal = document.getElementById('proformaModal');
        modal.style.display = 'none';
    }

      function deleteRow(icon) {
        var row = icon.closest('tr');
        row.remove();
      }

      function convertToInvoice(button) {
        var row = button.closest('tr');
        var cliente = row.cells[1].innerText;
        alert(`Convirtiendo la proforma de ${cliente} en factura.`);
        // Aquí podrías agregar el código para redirigir a otra página o ejecutar otra acción
    }

    ///tabla de detalles producto
    function eliminarFila(elemento) {
      // Busca la fila padre del ícono y la elimina
      var fila = elemento.closest('tr');
      fila.remove();
  }


/////////////////

function imprimirProforma() {
    // Clonar el contenido del modal
    var contenido = document.getElementById('proformaModal').cloneNode(true);
    
    // Crear una nueva ventana de impresión
    var ventanaImpresion = window.open('', '', 'height=900,width=800');

    // Escribir el contenido en la nueva ventana
    ventanaImpresion.document.write('<html><head><title>Proforma</title>');
    
    // Incluir el enlace a los iconos y estilos de impresión
    ventanaImpresion.document.write('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">');
    ventanaImpresion.document.write('<style>');
    
    // Definir estilos específicos para la impresión
    ventanaImpresion.document.write(`
        @media print {
            body {
                font-family: Arial, sans-serif;
                font-size: 20px; /* Tamaño de fuente más grande */
                margin: 0;
                padding: 40px; /* Aumentar el padding para dar más espacio */
            }
            .modal-content {
                width: 100%;
                margin: 0;
                padding: 20px;
            }
            h1, h2 {
                text-align: center;
                font-size: 24px; /* Aumentar el tamaño de los títulos */
            }
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 18px; /* Aumentar el tamaño del texto en las tablas */
            }
            th, td {
                padding: 12px; /* Aumentar el padding de las celdas */
                border: 1px solid black;
                text-align: left;
            }
            .header-right p {
                text-align: right;
                font-size: 18px; /* Aumentar el tamaño del texto en el encabezado */
            }
            .buttons, .buttons-imprimir-proforma, .close {
                display: none; /* Ocultar botones innecesarios */
            }
        }
    `);
    
    ventanaImpresion.document.write('</style></head><body>');
    
    // Añadir el contenido del modal
    ventanaImpresion.document.body.appendChild(contenido);
    
    // Cerrar el documento para que la impresión pueda proceder
    ventanaImpresion.document.close();

    // Esperar a que se cargue y luego lanzar la impresión
    ventanaImpresion.onload = function() {
        ventanaImpresion.focus();
        ventanaImpresion.print();
        ventanaImpresion.close(); // Cerrar la ventana después de imprimir
    };
}


</script>
  </body>
</html>

{% endblock content %}
